{"config":{"lang":["en","ja"],"separator":"[\\s\\-\uff0c\u3002]+","pipeline":["stemmer"]},"docs":[{"location":"k8s-learning/container/","title":"\u5bb9\u5668\u8fd0\u884c\u65f6","text":"<p>\u9996\u5148\u6211\u4eec\u8981\u660e\u786e\u4e00\u4e2a\u77e5\u8bc6\u70b9\u5c31\u662f \u5bb9\u5668\u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u4e2a\u8fdb\u7a0b \uff0c\u4e00\u4e2a\u7279\u6b8a\u7684\u8fdb\u7a0b\uff0c\u662f\u901a\u8fc7 Namespace \u5b9e\u73b0\u8d44\u6e90\uff08\u7f51\u7edc\u3001\u6587\u4ef6\u7cfb\u7edf\u7b49\uff09\u9694\u79bb\uff0c\u901a\u8fc7 Cgroups \u5b9e\u73b0\u8d44\u6e90\uff08CPU\u3001\u5185\u5b58\uff09\u9650\u5236\uff0c\u8ba9\u6211\u4eec\u4f7f\u7528\u8d77\u6765\u5c31\u611f\u89c9\u50cf\u5728\u64cd\u4f5c\u865a\u62df\u673a\u4e00\u6837\uff0c\u4f46\u5176\u548c\u865a\u62df\u673a\u6709\u672c\u8d28\u4e0a\u7684\u533a\u522b\uff0c\u90a3\u5c31\u662f\u5bb9\u5668\u548c\u5bbf\u4e3b\u673a\u662f\u5171\u4eab\u540c\u4e00\u4e2a\u5185\u6838\u7684\u3002\u4e3a\u4e86\u5c06\u6211\u4eec\u7684\u5e94\u7528\u8fdb\u7a0b\u8fd0\u884c\u5728\u5bb9\u5668\u4e2d\uff0c\u5f53\u7136\u5c31\u9700\u8981\u6709\u4e00\u4e9b\u65b9 \u4fbf\u7684\u63a5\u53e3\u6216\u8005\u547d\u4ee4\u53bb\u8c03\u7528 Linux \u7684\u7cfb\u7edf\u529f\u80fd\u6765\u5b9e\u73b0\uff0c\u800c\u5bb9\u5668\u8fd0\u884c\u65f6\u5c31\u662f\u7528\u6765\u8fd0\u884c\u548c\u7ba1\u7406\u5bb9\u5668\u8fdb\u7a0b\u3001\u955c\u50cf\u7684\u5de5\u5177\u3002</p>"},{"location":"k8s-learning/container/#_1","title":"\u5bb9\u5668\u8fd0\u884c\u65f6\u5206\u7c7b","text":"<p>\u5f53\u7136\u6700\u706b\u5927\u5bb6\u6700\u719f\u6089\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u975e Docker \u83ab\u5c5e\u4e86\uff0cDocker \u51ed\u501f\u4e00\u5df1\u4e4b\u529b\u5927\u5927\u63a8\u8fdb\u4e86\u5bb9\u5668\u6280\u672f\u7684\u666e\u53ca\u3002\u5f53\u7136\u968f\u7740\u5bb9\u5668\u751f\u6001\u7684\u4e0d\u65ad\u53d1\u5c55\uff0c\u4e1a\u754c\u4e5f\u6162\u6162\u51fa\u73b0\u4e86\u5176\u4ed6\u7684\u8fd0\u884c\u65f6\uff0c\u6bd4\u5982 Containerd\u3001rkt\u3001kata container\u3001cri-o \u7b49\u7b49\uff0c\u8fd9\u4e9b\u8fd0\u884c\u65f6\u63d0\u4f9b\u7684\u529f\u80fd\u4e0d\u5c3d\u76f8\u540c\uff0c\u6709\u4e9b\u53ea\u6709\u5bb9\u5668\u8fd0\u884c\u7684\u529f\u80fd\uff0c\u6709\u4e9b\u9664\u8fd0\u884c\u5bb9\u5668\u4e4b\u5916\u8fd8\u63d0\u4f9b\u4e86\u5bb9\u5668\u955c\u50cf\u7684\u7ba1\u7406\u529f\u80fd\u3002\u6839\u636e\u5bb9\u5668\u8fd0\u884c\u65f6\u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5bb9\u5668\u8fd0\u884c\u65f6\u5206\u4e3a\u4f4e\u5c42\u8fd0\u884c\u65f6\u548c\u9ad8\u5c42\u8fd0\u884c\u65f6</p> <p>\u4f4e\u5c42\u8fd0\u884c\u65f6\u4e3b\u8981\u8d1f\u8d23\u4e0e\u5bbf\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u6253\u4ea4\u9053\uff0c\u6839\u636e\u6307\u5b9a\u7684\u5bb9\u5668\u955c\u50cf\u5728\u5bbf\u4e3b\u673a\u4e0a\u8fd0\u884c\u5bb9\u5668\u8fdb\u7a0b\uff0c\u5e76\u5bf9\u5bb9\u5668\u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\u8fdb \u884c\u7ba1\u7406\uff0c\u4e5f\u5c31\u662f\u8d1f\u8d23\u8bbe\u7f6e\u5bb9\u5668 Namespace\u3001Cgroups \u7b49\u57fa\u7840\u64cd\u4f5c\u7684\u7ec4\u4ef6\uff0c\u5e38\u89c1\u7684\u4f4e\u5c42\u8fd0\u884c\u65f6\u6709\uff1a - runc \uff1a\u4f20\u7edf\u7684\u8fd0\u884c\u65f6\uff0c\u57fa\u4e8e Linux Namespace \u548c Cgroups \u6280\u672f\u5b9e\u73b0\uff0c\u4ee3\u8868\u5b9e\u73b0 Docker\u3001Containerd - runv \uff1a\u57fa\u4e8e\u865a\u62df\u673a\u7ba1\u7406\u7a0b\u5e8f\u7684\u8fd0\u884c\u65f6\uff0c\u901a\u8fc7\u865a\u62df\u5316 guest kernel\uff0c\u5c06\u5bb9\u5668\u548c\u4e3b\u673a\u9694\u79bb\u5f00\u6765\uff0c\u4f7f\u5f97\u5176\u8fb9\u754c\u66f4\u52a0\u6e05\u6670\uff0c \u4ee3\u8868\u5b9e\u73b0\u662f Kata Container \u548c Firecracker - runsc \uff1arunc + safety\uff0c\u901a\u8fc7\u62e6\u622a\u5e94\u7528\u7a0b\u5e8f\u7684\u6240\u6709\u7cfb\u7edf\u8c03\u7528\uff0c\u63d0\u4f9b\u5b89\u5168\u9694\u79bb\u7684\u8f7b\u91cf\u7ea7\u5bb9\u5668\u8fd0\u884c\u65f6\u6c99\u7bb1\uff0c\u4ee3\u8868\u5b9e\u73b0\u662f \u8c37\u6b4c\u7684 gVisor</p> <p>\u9ad8\u5c42\u8fd0\u884c\u65f6\u4e3b\u8981\u8d1f\u8d23\u955c\u50cf\u7684\u7ba1\u7406\u7b49\u5de5\u4f5c\uff0c\u4e3a\u5bb9\u5668\u7684\u8fd0\u884c\u505a\u51c6\u5907\uff0c\u4e3b\u6d41\u7684\u9ad8\u5c42\u8fd0\u884c\u65f6\u5305\u62ec Containerd\u3001CRI-O\u3002\u9ad8\u5c42\u8fd0\u884c \u65f6\u4e0e\u4f4e\u5c42\u8fd0\u884c\u65f6\u5404\u53f8\u5176\u804c\uff0c\u5bb9\u5668\u8fd0\u884c\u65f6\u4e00\u822c\u5148\u7531\u9ad8\u5c42\u8fd0\u884c\u65f6\u5c06\u5bb9\u5668\u955c\u50cf\u4e0b\u8f7d\u4e0b\u6765\uff0c\u5e76\u89e3\u538b\u8f6c\u6362\u4e3a\u5bb9\u5668\u8fd0\u884c\u9700\u8981\u7684\u64cd\u4f5c\u7cfb\u7edf\u6587 \u4ef6\uff0c\u518d\u7531\u4f4e\u5c42\u8fd0\u884c\u65f6\u542f\u52a8\u548c\u7ba1\u7406\u5bb9\u5668</p>"},{"location":"k8s-learning/container/#cri","title":"CRI","text":"<p>Kubernetes \u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53eb\u7740 CRI \u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u63a5\u53e3\uff0c\u90a3\u4e48\u8fd9\u4e2a CRI \u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1f\u8fd9\u4e2a\u5176\u5b9e\u4e5f\u548c Docker \u7684\u53d1\u5c55 \u5bc6\u5207\u76f8\u5173\u7684\u3002 \u5728 Kubernetes \u65e9\u671f\u7684\u65f6\u5019\uff0c\u5f53\u65f6 Docker \u5b9e\u5728\u662f\u592a\u706b\u4e86\uff0cKubernetes \u5f53\u7136\u4f1a\u5148\u9009\u62e9\u652f\u6301 Docker\uff0c\u800c\u4e14\u662f\u901a\u8fc7\u786c\u7f16 \u7801\u7684\u65b9\u5f0f\u76f4\u63a5\u8c03\u7528 Docker API\uff0c\u540e\u9762\u968f\u7740 Docker \u7684\u4e0d\u65ad\u53d1\u5c55\u4ee5\u53ca Google \u7684\u4e3b\u5bfc\uff0c\u51fa\u73b0\u4e86\u66f4\u591a\u5bb9\u5668\u8fd0\u884c\u65f6\uff0c Kubernetes \u4e3a\u4e86\u652f\u6301\u66f4\u591a\u66f4\u7cbe\u7b80\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\uff0cGoogle \u5c31\u548c\u7ea2\u5e3d\u4e3b\u5bfc\u63a8\u51fa\u4e86 CRI \u6807\u51c6\uff0c\u7528\u4e8e\u5c06 Kubernetes \u5e73\u53f0\u548c \u7279\u5b9a\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\uff08\u5f53\u7136\u4e3b\u8981\u662f\u4e3a\u4e86\u5e72\u6389 Docker\uff09\u89e3\u8026\u3002</p> <p>CRI\uff08Container Runtime Interface \u5bb9\u5668\u8fd0\u884c\u65f6\u63a5\u53e3\uff09\u672c\u8d28\u4e0a\u5c31\u662f Kubernetes \u5b9a\u4e49\u7684\u4e00\u7ec4\u4e0e\u5bb9\u5668\u8fd0\u884c\u65f6\u8fdb\u884c\u4ea4 \u4e92\u7684\u63a5\u53e3\uff0c\u6240\u4ee5\u53ea\u8981\u5b9e\u73b0\u4e86\u8fd9\u5957\u63a5\u53e3\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u90fd\u53ef\u4ee5\u5bf9\u63a5\u5230 Kubernetes \u5e73\u53f0\u4e0a\u6765\u3002\u4e0d\u8fc7 Kubernetes \u63a8\u51fa CRI \u8fd9\u5957\u6807\u51c6\u7684\u65f6\u5019\u8fd8\u6ca1\u6709\u73b0\u5728\u7684\u7edf\u6cbb\u5730\u4f4d\uff0c\u6240\u4ee5\u6709\u4e00\u4e9b\u5bb9\u5668\u8fd0\u884c\u65f6\u53ef\u80fd\u4e0d\u4f1a\u81ea\u8eab\u5c31\u53bb\u5b9e\u73b0 CRI \u63a5\u53e3\uff0c\u4e8e\u662f\u5c31\u6709\u4e86 shim\uff08\u57ab \u7247\uff09 \uff0c \u4e00\u4e2a shim \u7684\u804c\u8d23\u5c31\u662f\u4f5c\u4e3a\u9002\u914d\u5668\u5c06\u5404\u79cd\u5bb9\u5668\u8fd0\u884c\u65f6\u672c\u8eab\u7684\u63a5\u53e3\u9002\u914d\u5230 Kubernetes \u7684 CRI \u63a5\u53e3\u4e0a\uff0c\u5176\u4e2d dockershim \u5c31\u662f Kubernetes \u5bf9\u63a5 Docker \u5230 CRI \u63a5\u53e3\u4e0a\u7684\u4e00\u4e2a\u57ab\u7247\u5b9e\u73b0\u3002 </p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0cCRI \u4e3b\u8981\u6709 gRPC client\u3001gRPC Server \u548c\u5177\u4f53\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u4e09\u4e2a\u7ec4\u4ef6\u3002\u5176\u4e2d Kubelet \u4f5c\u4e3a gRPC \u7684\u5ba2\u6237\u7aef\u6765\u8c03\u7528 CRI \u63a5\u53e3\uff1bCRI shim \u4f5c\u4e3a gRPC \u670d\u52a1\u7aef\u6765\u54cd\u5e94 CRI \u8bf7\u6c42\uff0c\u8d1f\u8d23\u5c06 CRI \u8bf7\u6c42\u7684\u5185\u5bb9\u8f6c\u6362\u4e3a\u5177\u4f53 \u7684\u5bb9\u5668\u8fd0\u884c\u65f6 API\uff0c\u5728 kubelet \u548c\u8fd0\u884c\u65f6\u4e4b\u95f4\u5145\u5f53\u7ffb\u8bd1\u7684\u89d2\u8272\u3002\u5177\u4f53\u7684\u5bb9\u5668\u521b\u5efa\u903b\u8f91\u662f\uff0cKubernetes \u5728\u901a\u8fc7\u8c03\u5ea6\u6307\u5b9a \u4e00\u4e2a\u5177\u4f53\u7684\u8282\u70b9\u8fd0\u884c Pod\uff0c\u8be5\u8282\u70b9\u7684 Kubelet \u5728\u63a5\u5230 Pod \u521b\u5efa\u8bf7\u6c42\u540e\uff0c\u8c03\u7528\u4e00\u4e2a\u53eb\u4f5c GenericRuntime \u7684\u901a\u7528\u7ec4\u4ef6 \u6765\u53d1\u8d77\u521b\u5efa Pod \u7684 CRI \u8bf7\u6c42\u7ed9 CRI shim\uff1bCRI shim \u76d1\u542c\u4e00\u4e2a\u7aef\u53e3\u6765\u54cd\u5e94 Kubelet\uff0c\u5728\u6536\u5230 CRI \u8bf7\u6c42\u540e\uff0c\u5c06\u5176\u8f6c \u5316\u4e3a\u5177\u4f53\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u6307\u4ee4\uff0c\u5e76\u8c03\u7528\u76f8\u5e94\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u6765\u521b\u5efa Pod</p>"},{"location":"k8s-learning/container/#docker","title":"\u4e3a\u4f55\u629b\u5f03 Docker","text":"<p>Docker \u6700\u521d\u662f\u4e00\u4e2a\u5355\u4f53\u5f15\u64ce\uff0c\u4e3b\u8981\u8d1f\u8d23\u5bb9\u5668\u955c\u50cf\u7684\u5236\u4f5c\u3001\u4e0a\u4f20\u3001\u62c9\u53d6\u53ca\u5bb9\u5668\u7684\u8fd0 \u884c\u53ca\u7ba1\u7406\u3002\u968f\u7740\u5bb9\u5668\u6280\u672f\u7684\u7e41\u8363\u53d1\u5c55\uff0c\u4e3a\u4e86\u4fc3\u8fdb\u5bb9\u5668\u6280\u672f\u76f8\u5173\u7684\u89c4\u8303\u751f\u6210\u548c Docker \u81ea\u8eab\u9879\u76ee\u7684\u53d1\u5c55\uff0cDocker \u5c06\u5355\u4f53\u5f15\u64ce \u62c6\u5206\u4e3a\u4e09\u90e8\u5206\uff0c\u5206\u522b\u4e3a runc \u3001containerd \u548c dockerd\uff0c\u5176\u4e2d runc \u4e3b\u8981\u8d1f\u8d23\u5bb9\u5668\u7684\u8fd0\u884c\u548c\u751f\u547d\u5468\u671f\u7684\u7ba1\u7406\u3001 containerd \u4e3b\u8981\u8d1f\u8d23\u5bb9\u5668\u955c\u50cf\u7684\u4e0b\u8f7d\u548c\u89e3\u538b\u7b49\u955c\u50cf\u7ba1\u7406\u529f\u80fd\u3001dockerd \u4e3b\u8981\u8d1f\u8d23\u63d0\u4f9b\u955c\u50cf\u6784\u5efa\u3001\u4e0a\u4f20\u7b49\u529f\u80fd\u540c\u65f6\u63d0\u4f9b \u5bb9\u5668\u5b58\u50a8\u548c\u7f51\u7edc\u7684\u6620\u5c04\u529f\u80fd\uff0c\u540c\u65f6\u4e5f\u662f Docker \u670d\u52a1\u5668\u7aef\u7684\u5b88\u62a4\u8fdb\u7a0b\uff0c\u7528\u6765\u54cd\u5e94 Docker \u5ba2\u6237\u7aef\u53d1\u6765\u7684\u5404\u79cd\u5bb9\u5668\u3001\u955c\u50cf\u7ba1 \u7406\u7684\u4efb\u52a1\u3002Docker \u516c\u53f8\u5c06 runc \u6350\u732e\u7ed9\u4e86 OCI\uff0c\u5c06 containerd \u6350\u732e\u7ed9\u4e86 CNCF\uff0c\u5269\u4e0b\u7684 dockerd \u4f5c\u4e3a Docker \u8fd0\u884c\u65f6\u7531 Docker \u516c\u53f8\u81ea\u5df1\u7ef4\u62a4 \u5982\u524d\u6240\u8ff0\uff0cKubernetes \u5728\u5f15\u5165 CRI \u4e4b\u540e\uff0ckubelet \u9700\u8981\u901a\u8fc7 CRI shim \u53bb\u8c03\u7528\u5177\u4f53\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u5de5\u5177\uff0c\u7531\u4e8e\u65e9\u671f Kubernetes \u5bf9 Docker \u7684\u652f\u6301\u662f\u5185\u7f6e\u7684\uff0c\u56e0\u6b64\u5b98\u65b9\u81ea\u5df1\u5b9e\u73b0\u4e86 dockershim\uff0c\u901a\u8fc7 dockershim \u53bb\u8bbf\u95ee dockerd </p> <p>\u5047\u8bbe\u6211\u4eec\u4f7f\u7528\u7684\u662f Docker\uff0c\u5f53\u6211\u4eec\u5728 Kubernetes \u4e2d\u521b\u5efa\u4e00\u4e2a Pod \u7684\u65f6\u5019\uff0c\u9996\u5148\u5c31\u662f kubelet \u901a\u8fc7 CRI \u63a5\u53e3\u8c03\u7528 dockershim\uff0c\u8bf7\u6c42\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0ckubelet \u53ef\u4ee5\u89c6\u4f5c\u4e00\u4e2a\u7b80\u5355\u7684 CRI Client, \u800c dockershim \u5c31\u662f\u63a5\u6536\u8bf7\u6c42\u7684 Server\uff0c\u4e0d\u8fc7\u4ed6\u4eec\u90fd\u662f\u5728 kubelet \u5185\u7f6e\u7684\u3002 dockershim \u6536\u5230\u8bf7\u6c42\u540e, \u8f6c\u5316\u6210 dockerd \u80fd\u8bc6\u522b\u7684\u8bf7\u6c42, \u53d1\u5230 Docker Daemon \u4e0a\u8bf7\u6c42\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0c\u8bf7\u6c42\u5230\u4e86 Docker Daemon \u540e\u7eed\u5c31\u662f Docker \u521b\u5efa\u5bb9\u5668\u7684\u6d41\u7a0b\u4e86\uff0c\u53bb\u8c03\u7528 Containerd\uff0c\u7136\u540e\u521b\u5efa Containerd-shim \u8fdb\u7a0b\uff0c \u901a\u8fc7\u8be5\u8fdb\u7a0b\u53bb\u8c03\u7528 runc \u53bb\u771f\u6b63\u521b\u5efa\u5bb9\u5668\u3002 \u5176\u5b9e\u6211\u4eec\u4ed4\u7ec6\u89c2\u5bdf\u4e5f\u4e0d\u96be\u53d1\u73b0\u4f7f\u7528 Docker \u7684\u8bdd\u5176\u5b9e\u662f\u8c03\u7528\u94fe\u592a\u957f\uff0c\u771f\u6b63\u5bb9\u5668\u76f8\u5173\u7684\u64cd\u4f5c\u5176\u5b9e Containerd \u5c31\u5b8c\u5168\u8db3\u591f \u4e86\uff0cDocker \u592a\u8fc7\u4e8e\u590d\u6742\u7b28\u91cd\u4e86\uff0c\u5f53\u7136 Docker \u6df1\u53d7\u6b22\u8fce\u7684\u5f88\u5927\u4e00\u4e2a\u539f\u56e0\u5c31\u662f\u63d0\u4f9b\u4e86\u5f88\u591a\u5bf9\u7528\u6237\u64cd\u4f5c\u6bd4\u8f83\u53cb\u597d\u7684\u529f\u80fd\uff0c\u4f46\u662f \u5bf9\u4e8e Kubernetes \u6765\u8bf4\u538b\u6839\u4e0d\u9700\u8981\u8fd9\u4e9b\u529f\u80fd\uff0c\u56e0\u4e3a\u90fd\u662f\u901a\u8fc7\u63a5\u53e3\u53bb\u64cd\u4f5c\u5bb9\u5668\u7684\uff0c\u6240\u4ee5\u81ea\u7136\u4e5f\u5c31\u53ef\u4ee5\u5c06\u5bb9\u5668\u8fd0\u884c\u65f6\u5207\u6362\u5230 Containerd  </p> <p>\u5207\u6362\u5230 Containerd \u53ef\u4ee5\u6d88\u9664\u6389\u4e2d\u95f4\u73af\u8282\uff0c\u64cd\u4f5c\u4f53\u9a8c\u4e5f\u548c\u4ee5\u524d\u4e00\u6837\uff0c\u4f46\u662f\u7531\u4e8e\u76f4\u63a5\u7528\u5bb9\u5668\u8fd0\u884c\u65f6\u8c03\u5ea6\u5bb9\u5668\uff0c\u6240\u4ee5\u5b83\u4eec\u5bf9 Docker \u6765\u8bf4\u662f\u4e0d\u53ef\u89c1\u7684\u3002 \u56e0\u6b64\uff0c\u4f60\u4ee5\u524d\u7528\u6765\u68c0\u67e5\u8fd9\u4e9b\u5bb9\u5668\u7684 Docker \u5de5\u5177\u5c31\u4e0d\u80fd\u4f7f\u7528\u4e86\u3002 \u4f60\u4e0d\u80fd\u518d\u4f7f\u7528 docker ps \u6216 docker inspect \u547d\u4ee4\u6765\u83b7\u53d6\u5bb9\u5668\u4fe1\u606f\u3002\u7531\u4e8e\u4e0d\u80fd\u5217\u51fa\u5bb9\u5668\uff0c\u56e0\u6b64\u4e5f\u4e0d\u80fd\u83b7\u53d6\u65e5\u5fd7\u3001\u505c\u6b62 \u5bb9\u5668\uff0c\u751a\u81f3\u4e0d\u80fd\u901a\u8fc7 docker exec \u5728\u5bb9\u5668\u4e2d\u6267\u884c\u547d\u4ee4\u3002 \u5f53\u7136\u6211\u4eec\u4ecd\u7136\u53ef\u4ee5\u4e0b\u8f7d\u955c\u50cf\uff0c\u6216\u8005\u7528 docker build \u547d\u4ee4\u6784\u5efa\u955c\u50cf\uff0c\u4f46\u7528 Docker \u6784\u5efa\u3001\u4e0b\u8f7d\u7684\u955c\u50cf\uff0c\u5bf9\u4e8e\u5bb9\u5668\u8fd0\u884c\u65f6 \u548c Kubernetes\uff0c\u5747\u4e0d\u53ef\u89c1\u3002\u4e3a\u4e86\u5728 Kubernetes \u4e2d\u4f7f\u7528\uff0c\u9700\u8981\u628a\u955c\u50cf\u63a8\u9001\u5230\u955c\u50cf\u4ed3\u5e93\u4e2d\u53bb\u3002</p>"},{"location":"k8s-learning/core-resource-object/","title":"\u6838\u5fc3\u8d44\u6e90\u5bf9\u8c61","text":""},{"location":"k8s-learning/core-resource-object/#_1","title":"\u6838\u5fc3\u8d44\u6e90\u5bf9\u8c61","text":""},{"location":"k8s-learning/core-resource-object/#pod","title":"Pod","text":"<p>Pod \u662f\u4e00\u7ec4\u7d27\u5bc6\u5173\u8054\u7684\u5bb9\u5668\u96c6\u5408 \uff0c\u5b83\u4eec\u5171\u4eab PID\u3001IPC\u3001Network \u548c UTS namespace\uff0c\u662f Kubernetes \u8c03\u5ea6\u7684\u57fa\u672c \u5355\u4f4d\u3002Pod \u7684\u8bbe\u8ba1\u7406\u5ff5\u662f\u652f\u6301\u591a\u4e2a\u5bb9\u5668\u5728\u4e00\u4e2a Pod \u4e2d\u5171\u4eab\u7f51\u7edc\u548c\u6587\u4ef6\u7cfb\u7edf\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fdb\u7a0b\u95f4\u901a\u4fe1\u548c\u6587\u4ef6\u5171\u4eab\u8fd9\u79cd\u7b80\u5355\u9ad8\u6548 \u7684\u65b9\u5f0f\u7ec4\u5408\u5b8c\u6210\u670d\u52a1\u3002\u6211\u4eec\u77e5\u9053\u5bb9\u5668\u672c\u8d28\u4e0a\u5c31\u662f\u8fdb\u7a0b\uff0c\u90a3\u4e48 Pod \u5b9e\u9645\u4e0a\u5c31\u662f\u8fdb\u7a0b\u7ec4\u4e86\uff0c\u53ea\u662f\u8fd9\u4e00\u7ec4\u8fdb\u7a0b\u662f\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u6765\u8fdb\u884c\u8c03\u5ea6\u7684</p> <p></p> <p>\u5728kubernetes \u4e2d\uff0c\u6240\u6709\u8d44\u6e90\u5bf9\u8c61\u90fd\u4f7f\u7528\u8d44\u6e90\u6e05\u5355\uff08yaml \u6216 json\uff09\u6765\u5b9a\u4e49\uff0c\u6bd4\u5982\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u7b80\u5355\u7684 nginx \u670d \u52a1\uff0c\u5b83\u5305\u542b\u4e00\u4e2a\u955c\u50cf\u4e3a nginx \u7684\u5bb9\u5668\uff1a(nginx-pod.yaml) <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\nname: nginx\nlabels:\napp: nginx\nspec:\ncontainers:\n- name: nginx\nimage: nginx\nports:\n- containerPort: 80\n</code></pre> \u5b9a\u4e49\u4e86\u8fd9\u6837\u4e00\u4e2a\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5229\u7528\u4e0a\u9762\u6211\u4eec\u63d0\u5230\u7684 Kubectl \u5de5\u5177\u5c06\u8fd9\u4e2a Pod \u521b\u5efa\u5230 Kubernetes \u96c6\u7fa4\u4e2d <pre><code>kubectl apply -f nginx-pod.yaml\n</code></pre> Pod \u5728 Kubernetes \u96c6\u7fa4\u4e2d\u88ab\u521b\u5efa\u7684\u57fa\u672c\u6d41\u7a0b\u5982\u4e0b\u6240\u793a\uff1a </p> <ul> <li>\u7528\u6237\u901a\u8fc7 REST API \u521b\u5efa\u4e00\u4e2a Pod</li> <li>apiserver \u5c06\u5176\u5199\u5165 etcd</li> <li>scheduluer \u68c0\u6d4b\u5230\u672a\u7ed1\u5b9a Node \u7684 Pod\uff0c\u5f00\u59cb\u8c03\u5ea6\u5e76\u66f4\u65b0 Pod \u7684 Node \u7ed1\u5b9a</li> <li>kubelet \u68c0\u6d4b\u5230\u6709\u65b0\u7684 Pod \u8c03\u5ea6\u8fc7\u6765\uff0c\u901a\u8fc7 container runtime \u8fd0\u884c\u8be5 Pod</li> <li>kubelet \u901a\u8fc7 container runtime \u53d6\u5230 Pod \u72b6\u6001\uff0c\u5e76\u66f4\u65b0\u5230 apiserver \u4e2d</li> </ul>"},{"location":"k8s-learning/core-resource-object/#label","title":"Label","text":"<p>Label \u6807\u7b7e\u5728 Kubernetes \u8d44\u6e90\u5bf9\u8c61\u4e2d\u4f7f\u7528\u5f88\u591a\uff0c\u4e5f\u662f\u975e\u5e38\u91cd\u8981\u7684\u4e00\u4e2a\u5c5e\u6027\uff0cLabel \u662f\u8bc6\u522b Kubernetes \u5bf9\u8c61\u7684\u6807 \u7b7e\uff0c\u4ee5 key/value \u7684\u65b9\u5f0f\u9644\u52a0\u5230\u5bf9\u8c61\u4e0a\uff08key \u6700\u957f\u4e0d\u80fd\u8d85\u8fc7 63 \u5b57\u8282\uff0cvalue \u53ef\u4ee5\u4e3a\u7a7a\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e0d\u8d85\u8fc7 253 \u5b57\u8282 \u7684\u5b57\u7b26\u4e32\uff09\u4e0a\u9762\u6211\u4eec\u5b9a\u4e49\u7684 Nginx \u7684 Pod \u5c31\u6dfb\u52a0\u4e86\u4e00\u4e2a app=nginx \u7684 Label \u6807\u7b7e\u3002Label \u4e0d\u63d0\u4f9b\u552f\u4e00\u6027\uff0c\u5e76\u4e14\u5b9e \u9645\u4e0a\u7ecf\u5e38\u662f\u5f88\u591a\u5bf9\u8c61\uff08\u5982 Pods\uff09\u90fd\u4f7f\u7528\u76f8\u540c\u7684 Label \u6765\u6807\u5fd7\u5177\u4f53\u7684\u5e94\u7528\u3002Label \u5b9a\u4e49\u597d\u540e\u5176\u4ed6\u5bf9\u8c61\u53ef\u4ee5\u4f7f\u7528 Label Selector \u6765\u9009\u62e9\u4e00\u7ec4\u76f8\u540c Label \u7684\u5bf9\u8c61\uff08\u6bd4\u5982 Service \u7528 Label \u6765\u9009\u62e9\u4e00\u7ec4 Pod\uff09\u3002Label Selector \u652f\u6301\u4ee5 \u4e0b\u51e0\u79cd\u65b9\u5f0f\uff1a + \u7b49\u5f0f\uff0c\u5982 app=nginx \u548c env!$production + \u96c6\u5408\uff0c\u5982 env in (production, qa) + \u591a\u4e2a Label\uff08\u5b83\u4eec\u4e4b\u95f4\u662f AND\u5173\u7cfb\uff09\uff0c\u5982 app=nginx,env=test</p>"},{"location":"k8s-learning/core-resource-object/#namespace","title":"Namespace","text":"<p>Namespace\uff08\u547d\u540d\u7a7a\u95f4\uff09\u662f\u5bf9\u4e00\u7ec4\u8d44\u6e90\u548c\u5bf9\u8c61\u7684\u62bd\u8c61\u96c6\u5408\uff0c\u6bd4\u5982\u53ef\u4ee5\u7528\u6765\u5c06\u7cfb\u7edf\u5185\u90e8\u7684\u5bf9\u8c61\u5212\u5206\u4e3a\u4e0d\u540c\u7684\u9879\u76ee\u7ec4\u6216\u7528\u6237\u7ec4\u3002 \u5e38\u89c1\u7684 Pods\u3001Services\u3001Deployments \u7b49\u90fd\u662f\u5c5e\u4e8e\u67d0\u4e00\u4e2a Namespace \u7684\uff08\u9ed8\u8ba4\u662f default\uff09\uff0c\u6bd4\u5982\u4e0a\u9762\u6211\u4eec\u7684 Nginx Pod \u6ca1\u6709\u6307\u5b9a namespace\uff0c\u5219\u9ed8\u8ba4\u5c31\u5728 default \u547d\u540d\u7a7a\u95f4\u4e0b\u9762\uff0c\u800c Node, PersistentVolumes \u7b49\u8d44\u6e90\u5219 \u4e0d\u5c5e\u4e8e\u4efb\u4f55 Namespace\uff0c\u662f\u5168\u5c40\u7684</p>"},{"location":"k8s-learning/core-resource-object/#deployment","title":"Deployment","text":"<p>Pod \u662f Kubernetes \u96c6\u7fa4\u4e2d\u7684\u6700\u57fa\u672c\u7684\u8c03\u5ea6\u5355\u5143\uff0c\u4f46\u662f\u5982\u679c\u60f3\u8981\u521b\u5efa\u540c\u4e00\u4e2a\u5bb9\u5668\u7684\u591a\u4efd\u62f7\u8d1d\uff0c\u9700\u8981\u4e00\u4e2a\u4e00\u4e2a\u5206 \u522b\u521b\u5efa\u51fa\u6765\u4e48\uff0c\u90a3\u4e48\u80fd\u5426\u5c06 Pods \u5212\u5230\u4e00\u4e2a\u903b\u8f91\u7ec4\u91cc\u9762\u5462\uff1fDeployment \u5c31\u662f\u6765\u7ba1\u7406 Pod \u7684\u8d44\u6e90\u5bf9\u8c61\u3002 Deployment \u786e\u4fdd\u4efb\u610f\u65f6\u95f4\u90fd\u6709\u6307\u5b9a\u6570\u91cf\u7684 Pod\u201c\u526f\u672c\u201d\u5728\u8fd0\u884c\u3002\u5982\u679c\u4e3a\u67d0\u4e2a Pod \u521b\u5efa\u4e86 Deployment \u5e76\u4e14\u6307\u5b9a 3 \u4e2a \u526f\u672c\uff0c\u5b83\u4f1a\u521b\u5efa 3 \u4e2a Pod\uff0c\u5e76\u4e14\u6301\u7eed\u76d1\u63a7\u5b83\u4eec\u3002\u5982\u679c\u67d0\u4e2a Pod \u4e0d\u54cd\u5e94\uff0c\u90a3\u4e48 Deployment \u4f1a\u66ff\u6362\u5b83\uff0c\u59cb\u7ec8\u4fdd\u6301\u603b\u6570\u4e3a 3\u3002 \u5982\u679c\u4e4b\u524d\u4e0d\u54cd\u5e94\u7684 Pod \u6062\u590d\u4e86\uff0c\u73b0\u5728\u5c31\u6709 4 \u4e2a Pod \u4e86\uff0c\u90a3\u4e48 Deployment \u4f1a\u5c06\u5176\u4e2d\u4e00\u4e2a\u7ec8\u6b62\u4fdd\u6301\u603b\u6570\u4e3a 3\u3002\u5982\u679c\u5728 \u8fd0\u884c\u4e2d\u5c06\u526f\u672c\u603b\u6570\u6539\u4e3a 5\uff0cDeployment \u4f1a\u7acb\u523b\u542f\u52a8 2 \u4e2a\u65b0 Pod\uff0c\u4fdd\u8bc1\u603b\u6570\u4e3a 5\u3002\u6301\u56de\u6eda\u548c\u6eda\u52a8\u5347\u7ea7\u3002 \u5f53\u521b\u5efa Deployment \u65f6\uff0c\u9700\u8981\u6307\u5b9a\u4e24\u4e2a\u4e1c\u897f\uff1a + Pod \u6a21\u677f\uff1a\u7528\u6765\u521b\u5efa Pod \u526f\u672c\u7684\u6a21\u677f + Label \u6807\u7b7e\uff1aDeployment \u9700\u8981\u76d1\u63a7\u7684 Pod \u7684\u6807\u7b7e</p>"},{"location":"k8s-learning/core-resource-object/#service","title":"Service","text":"<p>Service \u662f\u5e94\u7528\u670d\u52a1\u7684\u62bd\u8c61\uff0c\u901a\u8fc7 Labels \u4e3a\u5e94\u7528\u63d0\u4f9b \u8d1f\u8f7d\u5747\u8861\u548c\u670d\u52a1\u53d1\u73b0\u3002\u5339\u914d Labels \u7684 Pod IP \u548c\u7aef\u53e3\u5217\u8868\u7ec4 \u6210 Endpoints\uff0c\u7531 kube-proxy \u8d1f\u8d23\u5c06\u670d\u52a1 IP \u8d1f\u8f7d\u5747\u8861\u5230\u8fd9\u4e9b Endpoints \u4e0a\u3002 \u6bcf\u4e2a Service \u90fd\u4f1a\u81ea\u52a8\u5206\u914d\u4e00\u4e2a cluster IP\uff08\u4ec5\u5728\u96c6\u7fa4\u5185\u90e8\u53ef\u8bbf\u95ee\u7684\u865a\u62df\u5730\u5740\uff09\u548c DNS \u540d\uff0c\u5176\u4ed6\u5bb9\u5668\u53ef\u4ee5\u901a\u8fc7\u8be5\u5730\u5740 \u6216 DNS \u6765\u8bbf\u95ee\u670d\u52a1\uff0c\u800c\u4e0d\u9700\u8981\u4e86\u89e3\u540e\u7aef\u5bb9\u5668\u7684\u8fd0\u884c </p>"},{"location":"k8s-learning/k8s-arch/","title":"K8S\u67b6\u6784","text":""},{"location":"k8s-learning/k8s-arch/#_1","title":"\u67b6\u6784","text":"<p>Kubernetes \u7531 Master \u548c Node \u4e24\u79cd\u8282\u70b9\u7ec4\u6210\uff0c\u8fd9\u4e24\u79cd\u89d2\u8272\u5206\u522b\u5bf9\u5e94\u7740\u63a7\u5236\u8282\u70b9\u548c\u5de5\u4f5c\u8282\u70b9</p> <p></p> <p>\u5176\u4e2d Master \u8282\u70b9\u7531\u4e09\u4e2a\u72ec\u7acb\u7684\u7ec4\u4ef6\u7ec4\u6210\uff0c\u5b83\u4eec\u5206\u522b\u662f\u8d1f\u8d23\u6574\u4e2a\u96c6\u7fa4\u901a\u4fe1\u7684 API \u670d\u52a1\u7684 kube-apiserver\u3001\u8d1f\u8d23\u5bb9\u5668 \u8c03\u5ea6\u7684 kube-scheduler \u4ee5\u53ca\u8d1f\u8d23\u7ef4\u62a4\u96c6\u7fa4\u72b6\u6001\u7684 kube-controller-manager \u7ec4\u4ef6\u3002\u6574\u4e2a\u96c6\u7fa4\u7684\u6570\u636e\u90fd\u662f\u901a\u8fc7 kube-apiserver \u4fdd\u5b58\u5230 etcd \u6570\u636e\u5e93\u4e2d\u7684\uff0c\u800c\u5176\u4ed6\u6240\u6709\u7ec4\u4ef6\u7684\u901a\u4fe1\u4e5f\u90fd\u662f\u901a\u8fc7 kube-apiserver \u548c etcd \u6570\u636e\u5e93\u8fdb \u884c\u901a\u4fe1\u7684\uff0c\u90fd\u4e0d\u4f1a\u76f4\u63a5\u548c etcd \u8fdb\u884c\u901a\u4fe1 \u5de5\u4f5c\u8282\u70b9\u4e0a\u6700\u6838\u5fc3\u7684\u7ec4\u4ef6\u5c31\u662f kubelet\uff0c\u5f53\u7136\u8fd8\u6709\u5e95\u5c42\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\uff0c\u6bd4\u5982 Docker\uff0c\u5176\u4e2d kubelet \u5c31\u662f\u4e3b\u8981\u6765\u5b9e\u73b0\u548c \u5e95\u5c42\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u8fdb\u884c\u901a\u4fe1\u7684\uff0c\u8fd9\u4e2a\u901a\u4fe1\u7684\u8fc7\u7a0b\u4e5f\u88ab Kubernetes \u62bd\u8c61\u6210\u4e86\u4e00\u4e2a CRI \uff08Container Runtime Interface\uff09\u7684\u8fdc\u7a0b\u8c03\u7528\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u91cc\u9762\u5b9a\u4e49\u4e86\u5bb9\u5668\u8fd0\u884c\u65f6\u7684\u6240\u6709\u6807\u51c6\u64cd\u4f5c\uff0c\u6bd4\u5982\u521b\u5efa\u5bb9\u5668\u3001\u5220\u9664\u5bb9\u5668\u7b49\u7b49 kubelet \u7684\u53e6\u5916\u4e00\u4e2a\u91cd\u8981\u529f\u80fd\u5c31\u662f\u8c03\u7528\u7f51\u7edc\u63d2\u4ef6\uff08CNI \uff09\u548c\u5b58\u50a8\u63d2\u4ef6\uff08 CSI \uff09\u4e3a\u5bb9\u5668\u914d\u7f6e\u7f51\u7edc\u548c\u5b58\u50a8\u529f\u80fd\uff0c\u540c\u6837\u7684 kubelet \u4e5f\u662f\u628a\u8fd9\u4e24\u4e2a\u91cd\u8981\u529f\u80fd\u901a\u8fc7\u63a5\u53e3\u66b4\u9732\u7ed9\u5916\u90e8\u4e86\uff0c\u6240\u4ee5\u5982\u679c\u6211\u4eec\u60f3\u8981\u5b9e\u73b0\u81ea\u5df1\u7684\u7f51\u7edc\u63d2\u4ef6\uff0c\u53ea\u9700\u8981\u4f7f\u7528 CNI \u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5bf9\u63a5\u5230 Kubernetes \u96c6\u7fa4\u5f53\u4e2d </p>"},{"location":"k8s-learning/k8s-arch/#_2","title":"\u7ec4\u4ef6","text":""},{"location":"k8s-learning/k8s-arch/#kube-apiserver","title":"kube-apiserver","text":"<p>API Server \u63d0\u4f9b\u4e86\u8d44\u6e90\u5bf9\u8c61\u7684\u552f\u4e00\u64cd\u4f5c\u5165\u53e3\uff0c\u5176\u5b83\u6240\u6709\u7ec4\u4ef6\u90fd\u5fc5\u987b\u901a\u8fc7\u5b83\u63d0\u4f9b\u7684 API \u6765\u64cd\u4f5c\u8d44\u6e90\u6570\u636e\u3002\u53ea\u6709 API Server \u4f1a\u4e0e etcd \u8fdb\u884c\u901a \u8fdb\u884c\u901a\u4fe1\u4fe1\uff0c\u5176\uff0c\u5176\u5b83\u6a21\u5757\u90fd \u5b83\u6a21\u5757\u90fd\u5fc5\u987b\u5fc5\u987b\u901a\u8fc7\u901a\u8fc7 API Server \u8bbf\u95ee\u96c6\u7fa4\u72b6\u6001\u3002API Server \u4f5c\u4e3a Kubernetes \u7cfb\u7edf\u7684\u5165\u53e3\uff0c\u5c01\u88c5\u4e86\u6838\u5fc3\u5bf9\u8c61\u7684\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u3002API Server \u4ee5 RESTFul \u63a5\u53e3\u65b9\u5f0f\u63d0\u4f9b\u7ed9\u5916\u90e8\u5ba2\u6237\u7aef\u548c\u5185 \u90e8\u7ec4\u4ef6\u8c03\u7528\uff0cAPI Server \u518d\u5bf9\u76f8\u5173\u7684\u8d44\u6e90\u6570\u636e\uff08\u5168\u91cf\u67e5\u8be2 + \u53d8\u5316\u76d1\u542c \uff09\u8fdb\u884c\u64cd\u4f5c\uff0c\u4ee5\u8fbe\u5230\u5b9e\u65f6\u5b8c\u6210\u76f8\u5173\u7684\u4e1a\u52a1\u529f\u80fd\u3002\u4ee5 API Server \u4e3a Kubernetes \u5165\u53e3\u7684\u8bbe\u8ba1\u4e3b\u8981\u6709\u4ee5\u4e0b\u597d\u5904\uff1a + \u4fdd\u8bc1\u4e86\u96c6\u7fa4\u72b6\u6001\u8bbf\u95ee\u7684\u5b89\u5168 + API Server \u9694\u79bb\u4e86\u96c6\u7fa4\u72b6\u6001\u8bbf\u95ee\u548c\u540e\u7aef\u5b58\u50a8\u5b9e\u73b0\uff0c\u8fd9\u6837 API Server \u72b6\u6001\u8bbf\u95ee\u7684\u65b9\u5f0f\u4e0d\u4f1a\u56e0\u4e3a\u540e\u7aef\u5b58\u50a8\u6280\u672f Etcd \u7684\u6539\u53d8\u800c\u6539\u53d8\uff0c\u8ba9\u540e\u7aef\u5b58\u50a8\u65b9\u5f0f\u9009\u62e9\u66f4\u52a0\u7075\u6d3b\uff0c\u65b9\u4fbf\u4e86\u6574\u4e2a\u67b6\u6784\u7684\u6269\u5c55</p>"},{"location":"k8s-learning/k8s-arch/#kube-controller-manager","title":"kube-controller-manager","text":"<p>Controller Manager \u7528\u4e8e\u5b9e\u73b0 Kubernetes \u96c6\u7fa4\u6545\u969c\u68c0\u6d4b\u548c\u6062\u590d\u7684\u81ea\u52a8\u5316\u5de5\u4f5c\u3002\u4e3b\u8981\u8d1f\u8d23\u6267\u884c\u5404\u79cd\u63a7\u5236\u5668\uff1a + Replication Controller\uff1a\u4e3b\u8981\u662f\u5b9a\u671f\u5173\u8054 Replication Controller (RC) \u548c Pod\uff0c\u4ee5\u4fdd\u8bc1\u96c6\u7fa4\u4e2d\u4e00\u4e2a RC (\u4e00\u79cd\u8d44\u6e90\u5bf9\u8c61) \u6240\u5173\u8054\u7684 Pod \u526f\u672c\u6570\u59cb\u7ec8\u4fdd\u6301\u4e3a\u4e0e\u9884\u8bbe\u503c\u4e00\u81f4 + Node Controller\uff1aKubelet \u5728\u542f\u52a8\u65f6\u4f1a\u901a\u8fc7 API Server \u6ce8\u518c\u81ea\u8eab\u7684\u8282\u70b9\u4fe1\u606f\uff0c\u5e76\u5b9a\u65f6\u5411 API Server \u6c47\u62a5 \u72b6\u6001\u4fe1\u606f\u3002API Server \u5728\u63a5\u6536\u5230\u4fe1\u606f\u540e\u5c06\u4fe1\u606f\u66f4\u65b0\u5230 Etcd \u4e2d\u3002Node Controller \u901a\u8fc7 API Server \u5b9e\u65f6\u83b7\u53d6 Node \u7684\u76f8\u5173\u4fe1\u606f\uff0c\u5b9e\u73b0\u7ba1\u7406\u548c\u76d1\u63a7\u96c6\u7fa4\u4e2d\u7684\u5404\u4e2a Node \u8282\u70b9\u7684\u76f8\u5173\u63a7\u5236\u529f\u80fd + Namespace Controller\uff1a\u7528\u6237\u901a\u8fc7 API Server \u53ef\u4ee5\u521b\u5efa\u65b0\u7684 Namespace \u5e76\u4fdd\u5b58\u5728 Etcd \u4e2d\uff0cNamespace Controller \u5b9a\u65f6\u901a\u8fc7 API Server \u8bfb\u53d6\u8fd9\u4e9b Namespace \u4fe1\u606f\u6765\u64cd\u4f5c Namespace\u3002\u6bd4\u5982\uff1aNamespace \u88ab API \u6807\u8bb0\u4e3a\u4f18\u96c5\u5220\u9664\uff0c\u5219\u5c06\u8be5 Namespace \u72b6\u6001\u8bbe\u7f6e\u4e3a Terminating \u5e76\u4fdd\u5b58\u5230 Etcd \u4e2d\u3002\u540c\u65f6 Namespace Controller \u5220\u9664\u8be5 Namespace \u4e0b\u7684 ServiceAccount\u3001Deployment\u3001Pod \u7b49\u8d44\u6e90\u5bf9\u8c61 + Service Account Controller\uff1a\u670d\u52a1\u8d26\u53f7\u63a7\u5236\u5668\u4e3b\u8981\u5728\u547d\u540d\u7a7a\u95f4\u5185\u7ba1\u7406 ServiceAccount\uff0c\u4ee5\u4fdd\u8bc1\u540d\u4e3a default \u7684 ServiceAccount \u5728\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d\u5b58\u5728 + Token Controller\uff1a\u4ee4\u724c\u63a7\u5236\u5668\u4f5c\u4e3a Controller Manager \u7684\u4e00\u90e8\u5206\uff0c\u4e3b\u8981\u7528\u4f5c\uff1a\u76d1\u542c serviceAccount \u7684 \u521b\u5efa\u548c\u5220\u9664\u52a8\u4f5c\u4ee5\u53ca\u76d1\u542c secret \u7684\u6dfb\u52a0\u3001\u5220\u9664\u52a8\u4f5c + Service Controller\uff1a\u670d\u52a1\u63a7\u5236\u5668\u4e3b\u8981\u7528\u4f5c\u76d1\u542c Service \u7684\u53d8\u5316\u3002\u6bd4\u5982\uff1a\u521b\u5efa\u7684\u662f\u4e00\u4e2a LoadBalancer \u7c7b\u578b\u7684 Service\uff0cService Controller \u5219\u8981\u786e\u4fdd\u5916\u90e8\u7684\u4e91\u5e73\u53f0\u4e0a\u5bf9\u8be5 Service \u5bf9\u5e94\u7684 LoadBalancer \u5b9e\u4f8b\u88ab\u521b\u5efa\u3001 \u5220\u9664\u4ee5\u53ca\u76f8\u5e94\u7684\u8def\u7531\u8f6c\u53d1\u8868\u88ab\u66f4\u65b0 + Endpoint Controller\uff1aEndpoints \u8868\u793a\u4e86\u4e00\u4e2a Service \u5bf9\u5e94\u7684\u6240\u6709 Pod \u526f\u672c\u7684\u8bbf\u95ee\u5730\u5740\uff0c\u800c Endpoints Controller \u662f\u8d1f\u8d23\u751f\u6210\u548c\u7ef4\u62a4\u6240\u6709 Endpoints \u5bf9\u8c61\u7684\u63a7\u5236\u5668\u3002Endpoint Controller \u8d1f\u8d23\u76d1\u542c Service \u548c \u5bf9\u5e94\u7684 Pod \u526f\u672c\u7684\u53d8\u5316\u3002\u5b9a\u671f\u5173\u8054 Service \u548c Pod (\u5173\u8054\u4fe1\u606f\u7531 Endpoint \u5bf9\u8c61\u7ef4\u62a4)\uff0c\u4ee5\u4fdd\u8bc1 Service \u5230 Pod \u7684\u6620\u5c04\u603b\u662f\u6700\u65b0\u7684</p>"},{"location":"k8s-learning/k8s-arch/#kube-scheduler","title":"kube-scheduler","text":"<p>Scheduler \u662f\u8d1f\u8d23\u6574\u4e2a\u96c6\u7fa4\u7684\u8d44\u6e90\u8c03\u5ea6\u7684\uff0c\u4e3b\u8981\u7684\u804c\u8d23\u5982\u4e0b\u6240\u793a\uff1a - \u4e3b\u8981\u7528\u4e8e\u6536\u96c6\u548c\u5206\u6790\u5f53\u524d Kubernetes \u96c6\u7fa4\u4e2d\u6240\u6709 Node \u8282\u70b9\u7684\u8d44\u6e90 (\u5305\u62ec\u5185\u5b58\u3001CPU \u7b49) \u8d1f\u8f7d\u60c5\u51b5\uff0c\u7136\u540e\u4f9d\u636e\u8d44 \u6e90\u5360\u7528\u60c5\u51b5\u5206\u53d1\u65b0\u5efa\u7684 Pod \u5230 Kubernetes \u96c6\u7fa4\u4e2d\u53ef\u7528\u7684\u8282\u70b9 - \u5b9e\u65f6\u76d1\u6d4b Kubernetes \u96c6\u7fa4\u4e2d\u672a\u5206\u53d1\u548c\u5df2\u5206\u53d1\u7684\u6240\u6709\u8fd0\u884c\u7684 Pod - \u5b9e\u65f6\u76d1\u6d4b Node \u8282\u70b9\u4fe1\u606f\uff0c\u7531\u4e8e\u4f1a\u9891\u7e41\u67e5\u627e Node \u8282\u70b9\uff0c\u6240\u4ee5 Scheduler \u540c\u65f6\u4f1a\u7f13\u5b58\u4e00\u4efd\u6700\u65b0\u7684\u4fe1\u606f\u5728\u672c\u5730 - \u5728\u5206\u53d1 Pod \u5230\u6307\u5b9a\u7684 Node \u8282\u70b9\u540e\uff0c\u4f1a\u628a Pod \u76f8\u5173\u7684 Binding \u4fe1\u606f\u5199\u56de API Server\uff0c\u4ee5\u65b9\u4fbf\u5176\u5b83\u7ec4\u4ef6\u4f7f\u7528</p>"},{"location":"k8s-learning/k8s-arch/#kubelet","title":"kubelet","text":"<p>kubelet \u662f\u8d1f\u8d23\u5bb9\u5668\u771f\u6b63\u8fd0\u884c\u7684\u6838\u5fc3\u7ec4\u4ef6\uff0c\u4e3b\u8981\u7684\u804c\u8d23\u5982\u4e0b\u6240\u793a\uff1a - \u8d1f\u8d23 Node \u8282\u70b9\u4e0a Pod \u7684\u521b\u5efa\u3001\u4fee\u6539\u3001\u76d1\u63a7\u3001\u5220\u9664\u7b49\u5168\u751f\u547d\u5468\u671f\u7684\u7ba1\u7406 - \u5b9a\u65f6\u4e0a\u62a5\u672c\u5730 Node \u7684\u72b6\u6001\u4fe1\u606f\u7ed9 API Server - kubelet \u662f Master \u548c Node \u4e4b\u95f4\u7684\u6865\u6881\uff0c\u63a5\u6536 API Server \u5206\u914d\u7ed9\u5b83\u7684\u4efb\u52a1\u5e76\u6267\u884c - kubelet \u901a\u8fc7 API Server \u95f4\u63a5\u4e0e Etcd \u96c6\u7fa4\u4ea4\u4e92\u6765\u8bfb\u53d6\u96c6\u7fa4\u914d\u7f6e\u4fe1\u606f - kubelet \u5728 Node \u4e0a\u505a\u7684\u4e3b\u8981\u5de5\u4f5c\u5177\u4f53\u5982\u4e0b\uff1a     1. \u8bbe\u7f6e\u5bb9\u5668\u7684\u73af\u5883\u53d8\u91cf\u3001\u7ed9\u5bb9\u5668\u7ed1\u5b9a Volume\u3001\u7ed9\u5bb9\u5668\u7ed1\u5b9a Port\u3001\u6839\u636e\u6307\u5b9a\u7684 Pod \u8fd0\u884c\u4e00\u4e2a\u5355\u4e00\u5bb9\u5668\u3001\u7ed9\u6307\u5b9a\u7684Pod \u521b\u5efa Network \u5bb9\u5668     2. \u540c\u6b65 Pod \u7684\u72b6\u6001     3. \u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u547d\u4ee4\u3001\u6740\u6b7b\u5bb9\u5668\u3001\u5220\u9664 Pod \u7684\u6240\u6709\u5bb9\u5668</p>"},{"location":"k8s-learning/k8s-arch/#kube-proxy","title":"kube-proxy","text":"<p>kube-proxy \u662f\u4e3a\u4e86\u89e3\u51b3\u5916\u90e8\u7f51\u7edc\u80fd\u591f\u8bbf\u95ee\u96c6\u7fa4\u4e2d\u5bb9\u5668\u63d0\u4f9b\u7684\u5e94\u7528\u670d\u52a1\u800c\u8bbe\u8ba1\u7684\uff0cProxy \u8fd0\u884c\u5728\u6bcf\u4e2a Node \u4e0a\u3002 \u6bcf\u521b\u5efa\u4e00\u4e2a Service\uff0ckube-proxy \u5c31\u4f1a\u4ece API Server \u83b7\u53d6 Services \u548c Endpoints \u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u7136\u540e\u6839\u636e\u5176 \u914d\u7f6e\u4fe1\u606f\u5728 Node \u4e0a\u542f\u52a8\u4e00\u4e2a Proxy \u7684\u8fdb\u7a0b\u5e76\u76d1\u542c\u76f8\u5e94\u7684\u670d\u52a1\u7aef\u53e3\u3002 \u5f53\u63a5\u6536\u5230\u5916\u90e8\u8bf7\u6c42\u65f6\uff0ckube-proxy \u4f1a\u6839\u636e Load Balancer \u5c06\u8bf7\u6c42\u5206\u53d1\u5230\u540e\u7aef\u6b63\u786e\u7684\u5bb9\u5668\u5904\u7406\u3002 kube-proxy \u4e0d\u4f46\u89e3\u51b3\u4e86\u540c\u4e00\u5bbf\u4e3b\u673a\u76f8\u540c\u670d\u52a1\u7aef\u53e3\u51b2\u7a81\u7684\u95ee\u9898\uff0c\u8fd8\u63d0\u4f9b\u4e86 Service \u8f6c\u53d1\u670d\u52a1\u7aef\u53e3\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684\u80fd\u529b\u3002 kube-proxy \u540e\u7aef\u4f7f\u7528\u968f\u673a\u3001\u8f6e\u5faa\u7b49\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u8fdb\u884c\u8c03\u5ea6\u3002</p>"},{"location":"k8s-learning/k8s-arch/#kubectl","title":"kubectl","text":"<p>Kubectl \u662f Kubernetes \u7684\u96c6\u7fa4\u7ba1\u7406\u547d\u4ee4\u884c\u5ba2\u6237\u7aef\u5de5\u5177\u96c6\u3002\u901a\u8fc7 Kubectl \u547d\u4ee4\u5bf9 API Server \u8fdb\u884c\u64cd\u4f5c\uff0cAPI Server \u54cd\u5e94\u5e76\u8fd4\u56de\u5bf9\u5e94\u7684\u547d\u4ee4\u7ed3\u679c\uff0c\u4ece\u800c\u8fbe\u5230\u5bf9 Kubernetes \u96c6\u7fa4\u7684\u7ba1\u7406</p>"},{"location":"k8s-learning/why-k8s/","title":"\u4e3a\u4f55\u4f7f\u7528K8S","text":""},{"location":"k8s-learning/why-k8s/#k8s","title":"\u4e3a\u4f55\u4f7f\u7528K8S","text":"<p>\u4f7f\u7528 Kubernetes \u7684\u7406\u7531\u5f88\u591a\uff0c\u6700\u91cd\u8981\u7684\u7406\u7531\u662f\uff0cIT \u884c\u4e1a\u4ece\u6765\u90fd\u662f\u7531\u65b0\u6280\u672f\u9a71\u52a8\u7684\u3002Docker \u5bb9\u5668\u5316\u6280\u672f\u5df2\u7ecf\u88ab\u5f88\u591a\u516c \u53f8\u91c7\u7528\uff0c\u4ece\u5355\u4ece\u5355\u673a\u673a\u8d70\u8d70\u5411\u96c6\u7fa4\u5df2\u6210 \u5411\u96c6\u7fa4\u5df2\u6210\u4e3a\u4e3a\u5fc5\u5fc5\u7136\u7136\u3002\u4e91\u8ba1\u7b97\u7684\u84ec\u52c3\u53d1\u5c55\u6b63\u5728\u52a0\u901f\u8fd9\u4e00\u8fdb\u7a0b\uff0cKubernetes \u4f5c\u4e3a\u5f53\u524d\u88ab\u4e1a\u754c\u5e7f\u6cdb\u8ba4\u53ef\u548c\u770b \u597d\u7684\u57fa\u4e8e Docker \u7684\u5927\u89c4\u6a21\u5bb9\u5668\u5316\u5206\u5e03\u5f0f\u7cfb\u7edf\u89e3\u51b3\u65b9\u6848</p> <p>\u4e00\u4e2a\u5e73\u53f0\u641e\u5b9a\u6240\u6709</p> <p>\u4f7f\u7528 Kubernetes \u90e8\u7f72\u4efb\u4f55\u5e94\u7528\u90fd\u662f\u5c0f\u83dc\u4e00\u789f\u3002\u53ea\u8981\u5e94\u7528\u53ef\u4ee5\u6253\u5305\u6210\u955c\u50cf\uff0c\u80fd\u591f\u5bb9\u5668\u90e8\u7f72\uff0cKubernetes \u5c31\u4e00\u5b9a\u80fd\u542f\u52a8\u5b83\u3002\u7ba1\u4ec0\u4e48\u8bed\u8a00\u3001\u4ec0\u4e48\u6846\u67b6\u5199\u7684\u5e94\u7528\uff08\u5982 Java, Python, Node.js\uff09\uff0cKubernetes \u90fd\u53ef\u4ee5\u5728\u4efb\u4f55\u73af\u5883\u4e2d\u5b89\u5168\u7684\u542f\u52a8\u5b83\uff0c \u5982\u7269\u7406\u670d\u52a1\u5668\u3001\u865a\u62df\u673a\u3001\u4e91\u73af\u5883\u3002 </p> <p>\u4e91\u73af\u5883\u65e0\u7f1d\u8fc1\u79fb</p> <p>Kubernetes \u5b8c\u5168\u517c\u5bb9\u5404\u79cd\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\uff0c\u4f8b\u5982 Google Cloud\u3001Amazon\u3001Microsoft Azure\u3001\u963f\u91cc\u4e91\u7b49\uff0c\u8fd8\u53ef\u4ee5\u5de5\u4f5c\u5728 CloudStack, OpenStack, VSphere \u4e0a\u7b49</p> <p></p> <p>\u9ad8\u6548\u7684\u5229\u7528\u8d44\u6e90</p> <p>kubernetes \u5982\u679c\u53d1\u73b0\u6709\u8282\u70b9\u5de5\u4f5c\u4e0d\u9971\u548c\uff0c\u4fbf\u4f1a\u91cd\u65b0\u5206\u914d Pod\uff0c\u5e2e\u52a9\u6211\u4eec\u8282\u7701\u5f00\u9500\uff0c\u9ad8\u6548\u7684\u5229\u7528\u5185\u5b58\u3001\u5904\u7406\u5668\u7b49\u8d44\u6e90\u3002 \u5982\u679c\u4e00\u4e2a\u8282\u70b9\u5b95\u673a\u4e86\uff0cKubernetes \u4f1a\u81ea\u52a8\u91cd\u65b0\u521b\u5efa\u4e4b\u524d\u8fd0\u884c\u5728\u6b64\u8282\u70b9\u4e0a\u7684 Pod\uff0c\u5728\u5176\u4ed6\u8282\u70b9\u4e0a\u8fd0\u884c</p> <p></p> <p>\u5f00\u7bb1\u5373\u7528\u7684\u81ea\u52a8\u7f29\u653e\u80fd\u529b</p> <p>\u7f51\u7edc\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u590d\u5236\u7b49\u7279\u6027\uff0c\u5bf9\u4e8e Kubernetes \u90fd\u662f\u5f00\u7bb1\u5373\u7528\u7684\u3002 Pod \u662f\u65e0\u72b6\u6001\u8fd0\u884c\u7684\uff0c\u4efb\u4f55\u65f6\u5019\u6709 Pod \u5b95\u4e86\uff0c\u7acb\u9a6c\u4f1a\u6709\u5176\u4ed6 Pod \u63a5\u66ff\u5b83\u7684\u5de5\u4f5c\uff0c\u7528\u6237\u5b8c\u5168\u611f\u89c9\u4e0d\u5230\u3002 \u5982\u679c\u7528\u6237\u91cf\u7a81\u7136\u66b4\u589e\uff0c\u73b0\u6709\u7684 Pod \u89c4\u6a21\u4e0d\u8db3\u4e86\uff0c\u90a3\u4e48\u4f1a\u81ea\u52a8\u521b\u5efa\u51fa\u4e00\u6279\u65b0\u7684 Pod\uff0c\u4ee5\u9002\u5e94\u5f53\u524d\u7684\u9700\u6c42\u3002 \u53cd\u4e4b\u4ea6\u7136\uff0c\u5f53\u8d1f\u8f7d\u964d\u4e0b\u6765\u7684\u65f6\u5019\uff0cKubernetes \u4e5f\u4f1a\u81ea\u52a8\u7f29\u51cf Pod \u7684\u6570\u91cf\u3002 </p> <p>\u4f7f DevOps \u66f4\u7b80\u5355</p> <p>\u4e0d\u5fc5\u7cbe\u901a Chef \u6216 Ansible \u8fd9\u7c7b\u5de5\u5177\uff0c\u53ea\u9700\u8981\u5bf9 CI \u670d\u52a1\u5199\u4e2a\u7b80\u5355\u7684\u811a\u672c\u7136\u540e\u8fd0\u884c\u5b83\uff0c\u5c31\u4f1a\u4f7f\u7528\u4f60\u7684\u4ee3\u7801\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Pod\uff0c\u5e76\u90e8\u7f72\u5230 Kubernetes \u96c6\u7fa4\u91cc\u9762\u3002 </p> <p>\u53ef\u9760\u6027</p> <p>kubernetes \u5982\u6b64\u6d41\u884c\u7684\u4e00\u4e2a\u91cd\u8981\u539f\u56e0\u662f\uff1a\u5e94\u7528\u4f1a\u4e00\u76f4\u987a\u5229\u8fd0\u884c\uff0c\u4e0d\u4f1a\u88ab Pod \u6216\u8282\u70b9\u7684\u6545\u969c\u6240\u4e2d\u65ad\u3002 \u5982\u679c\u51fa\u73b0\u6545\u969c\uff0cKubernetes \u4f1a\u521b\u5efa\u5fc5\u8981\u6570\u91cf\u7684\u5e94\u7528\u955c\u50cf\uff0c\u5e76\u5206\u914d\u5230\u5065\u5eb7\u7684 Pod \u6216\u8282\u70b9\u4e2d\uff0c\u76f4\u5230\u7cfb\u7edf\u6062\u590d\u3002 \u4e00\u4e2a\u5bb9\u5668\u5316\u7684\u57fa\u7840\u8bbe\u65bd\u662f\u6709\u81ea\u6108\u80fd\u529b\u7684\uff0c\u53ef\u4ee5\u63d0\u4f9b\u5e94\u7528\u7a0b\u5e8f\u7684\u4e0d\u95f4\u65ad\u64cd\u4f5c\uff0c\u5373\u4f7f\u4e00\u90e8\u5206\u57fa\u7840\u8bbe\u65bd\u51fa\u73b0\u6545\u969c </p>"},{"location":"k8s-learning/k8s-cluster-deploy/kind/","title":"kind\u5b89\u88c5","text":"<p>Kind \u662f Kubernetes in Docker \u7684\u7b80\u5199\uff0c\u662f\u4e00\u4e2a\u4f7f\u7528 Docker \u5bb9\u5668\u4f5c\u4e3a Node \u8282\u70b9\uff0c\u5728\u672c\u5730\u521b\u5efa\u548c\u8fd0\u884cKubernetes \u96c6\u7fa4\u7684\u5de5\u5177\u3002\u9002\u7528\u4e8e\u5728\u672c\u673a\u521b\u5efa Kubernetes \u96c6\u7fa4\u73af\u5883\u8fdb\u884c\u5f00\u53d1\u548c\u6d4b\u8bd5\u3002\u4f7f\u7528 Kind \u642d\u5efa\u7684\u96c6\u7fa4\u65e0\u6cd5\u5728\u751f\u4ea7\u4e2d\u4f7f\u7528\uff0c\u4f46\u662f\u5982\u679c\u4f60\u53ea\u662f\u60f3\u5728\u672c\u5730\u7b80\u5355\u7684\u73a9\u73a9 K8s\uff0c\u4e0d\u60f3\u5360\u7528\u592a\u591a\u7684\u8d44\u6e90\uff0c\u90a3\u4e48\u4f7f\u7528 Kind \u662f\u4f60\u4e0d\u9519\u7684\u9009\u62e9\u3002</p> <p>Kind \u5185\u90e8\u4e5f\u662f\u4f7f\u7528 Kubeadm \u521b\u5efa\u548c\u542f\u52a8\u96c6\u7fa4\u8282\u70b9\uff0c\u5e76\u4f7f\u7528 Containerd \u4f5c\u4e3a\u5bb9\u5668\u8fd0\u884c\u65f6\uff0c\u6240\u4ee5\u5f03\u7528 dockershim\u5bf9 Kind \u6ca1\u6709\u4ec0\u4e48\u5f71\u54cd\u3002</p> <p>Kind\u5c06 Docker \u5bb9\u5668\u4f5c\u4e3a Kubernetes \u7684 Node \u8282\u70b9\uff0c\u5e76\u5728\u8be5 Node \u4e2d\u5b89\u88c5 Kubernetes\u7ec4\u4ef6\uff0c\u5305\u62ec\u4e00\u4e2a\u6216\u8005\u591a\u4e2a Control Plane \u548c\u4e00\u4e2a\u6216\u8005\u591a\u4e2a Work Nodes\u3002\u8fd9\u5c31\u89e3\u51b3\u4e86\u5728\u672c\u673a\u8fd0\u884c\u591a\u4e2a Node \u7684\u95ee\u9898\uff0c\u800c\u4e0d\u9700\u8981\u865a\u62df\u5316\u3002</p>"},{"location":"k8s-learning/k8s-cluster-deploy/kind/#_1","title":"\u5b89\u88c5","text":"<p>\u8981\u4f7f\u7528 Kind \u7684\u524d\u63d0\u662f\u63d0\u4f9b\u4e00\u4e2a Docker \u73af\u5883\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u5feb\u901f\u5b89\u88c5\u3002 <pre><code>sudo sh -c \"$(curl -fsSL https:\"(get.docker.com)\"\n</code></pre> \u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u684c\u9762\u7248\uff0cDocker \u5b89\u88c5\u8fc7\u540e\u63a5\u4e0b\u6765\u53ef\u4ee5\u5b89\u88c5\u4e00\u4e2a kubectl \u5de5\u5177\uff0cKind \u672c\u8eab\u4e0d\u9700\u8981 kubectl\uff0c\u5b89\u88c5 kubectl \u53ef\u4ee5\u5728\u672c\u673a\u76f4\u63a5\u7ba1\u7406 Kubernetes \u96c6\u7fa4</p> <p>Linux\u7cfb\u7edf <pre><code>curl -LO \"https://dl.k8s.io/release/$(curl -L -s\nhttps://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\"\nsudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl\n#\u9a8c\u8bc1\u7248\u672c\nkubectl version --client\n</code></pre> \u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u5b89\u88c5 Kind \u4e86\uff0c\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662f\u5728 Github Release \u9875\u9762 \u76f4\u63a5\u4e0b\u8f7d\u5bf9\u5e94\u7684\u5b89\u88c5\u5305\u5373\u53ef\uff0c\u6bd4\u5982\u6211\u4eec\u8fd9\u91cc\u5b89\u88c5\u6700\u65b0\u7684 v0.17.0 \u7248\u672c <pre><code>wget https://github.com/kubernetes-sigs/kind/releases/download/v0.17.0/kind-darwin-amd64\n# \u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u52a0\u901f\n# wget https://ghps.cc/https://github.com/kubernetes-sigs/kind/releases/download/v0.17.0/kind-darwin-amd64\n# chmod +x kind-darwin-amd64\n# sudo mv kind-darwin-amd64 /usr/local/bin/kind\n# \u9a8c\u8bc1\u7248\u672c\n# kind version\nkind v0.17.0 go1.19.2 darwin/amd64\n</code></pre></p>"},{"location":"k8s-learning/k8s-cluster-deploy/kind/#_2","title":"\u64cd\u4f5c","text":"<p>\u521b\u5efa\u6307\u5b9a\u540d\u79f0\u7684\u96c6\u7fa4 <pre><code>#kind create cluster --name kind-2\n</code></pre> \u4f7f\u7528 kind get clusters \u547d\u4ee4\u6765\u83b7\u53d6\u96c6\u7fa4\u5217\u8868 <pre><code>#kind get clusters\nkind\nkind-2\nkind-3\n</code></pre> \u5f53\u6709\u591a\u4e2a\u96c6\u7fa4\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 kubectl \u6765\u5207\u6362\u8981\u7ba1\u7406\u7684\u96c6\u7fa4\uff1a <pre><code>#\u5207\u6362\u5230\u96c6\u7fa4 `kind`\nkubectl config use-context kind-kind\n# \u5207\u6362\u5230\u7fa4\u96c6`kind-2`\nkubectl config use-context kind-kind-2\n</code></pre> \u5220\u9664\u96c6\u7fa4 <pre><code>kind delete cluster --name kind-2\n</code></pre></p>"},{"location":"k8s-learning/k8s-cluster-deploy/kubeadm/","title":"kubeadm\u5b89\u88c5","text":"<p>Kubeadm \u662f\u4e00\u4e2a\u5b89\u88c5 K8s \u96c6\u7fa4\u7684\u5de5\u5177\u5305\uff0c\u53ef\u5e2e\u52a9\u4f60\u4ee5\u66f4\u7b80\u5355\u3001\u5408\u7406\u5b89\u5168\u548c\u53ef\u6269\u5c55\u7684\u65b9\u5f0f\u5f15\u5bfc\u6700\u4f73\u5b9e\u8df5 Kubernetes \u7fa4 \u96c6\u3002\u5b83\u8fd8\u652f\u6301\u4e3a\u4f60\u7ba1\u7406 Bootstrap Tokens \u5e76\u5347\u7ea7/\u964d\u7ea7\u96c6\u7fa4</p> <p>Kubeadm \u7684\u76ee\u6807\u662f\u5efa\u7acb\u4e00\u4e2a\u901a\u8fc7 Kubernetes \u4e00\u81f4\u6027\u6d4b\u8bd5\u7684\u6700\u5c0f\u53ef\u884c\u96c6\u7fa4 \uff0c\u4f46\u4e0d\u4f1a\u5b89\u88c5\u5176\u4ed6\u529f\u80fd\u63d2\u4ef6\u3002\u5728\u8bbe\u8ba1\u4e0a\u5e76\u672a\u5b89 \u88c5\u7f51\u7edc\u89e3\u51b3\u65b9\u6848\uff0c\u6240\u4ee5\u9700\u8981\u7528\u6237\u81ea\u884c\u5b89\u88c5\u7b2c\u4e09\u65b9\u7b26\u5408 CNI \u7684\u7f51\u7edc\u89e3\u51b3\u65b9\u6848\uff08\u5982 flanal\uff0ccalico \u7b49\uff09\u3002\u6b64\u5916 Kubeadm \u53ef\u4ee5\u5728\u591a\u79cd\u8bbe\u5907\u4e0a\u8fd0\u884c\uff0c\u53ef\u4ee5\u662f Linux \u7b14\u8bb0\u672c\u7535\u8111\u3001\u865a\u62df\u673a\u3001\u7269\u7406/\u4e91\u670d\u52a1\u5668\u6216 Raspberry Pi\uff0c\u8fd9\u4f7f\u5f97 Kubeadm \u975e\u5e38 \u9002\u5408\u4e0e\u4e0d\u540c\u79cd\u7c7b\u7684\u914d\u7f6e\u7cfb\u7edf\uff08\u4f8b\u5982 Terraform\uff0cAnsible \u7b49\uff09\u96c6\u6210</p>"},{"location":"k8s-learning/k8s-cluster-deploy/kubeadm/#_1","title":"\u73af\u5883\u51c6\u5907","text":"<p>3 \u4e2a\u8282\u70b9\uff0c\u90fd\u662f Centos 7.6 \u7cfb\u7edf\uff0c\u5185\u6838\u7248\u672c\uff1a3.10.0-1160.71.1.el7.x86_64\uff0c\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u6dfb\u52a0 hosts \u4fe1\u606f <pre><code>cat /etc/hosts\n172.21.0.2 master\n172.21.0.3 node1\n172.21.0.4 node2\n</code></pre></p> <p>\u7ed3\u70b9\u7684 hostname \u5fc5\u987b\u4f7f\u7528\u6807\u51c6\u7684 DNS \u547d\u540d\uff0c\u53e6\u5916\u5343\u4e07\u522b\u7528\u9ed8\u8ba4 localhost \u7684 hostname\uff0c\u4f1a\u5bfc\u81f4\u5404\u79cd\u9519\u8bef\u51fa\u73b0\u7684\u3002\u5728 Kubernetes \u9879\u76ee\u91cc\uff0c\u673a\u5668\u7684\u540d\u5b57\u4ee5\u53ca\u4e00\u5207\u5b58\u50a8\u5728 Etcd \u4e2d\u7684 API \u5bf9\u8c61\uff0c\u90fd\u5fc5\u987b\u4f7f\u7528\u6807\u51c6\u7684 DNS \u547d\u540d\uff08RFC 1123\uff09\u3002\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 hostnamectl set-hostname xxx \u6765\u4fee\u6539 hostname  </p> <p>\u4e0b\u9762\u662f\u4e00\u4e9b\u73af\u5883\u51c6\u5907\u5de5\u4f5c\uff0c\u9700\u8981\u5728\u6240\u6709\u8282\u70b9\u914d\u7f6e\u3002 \u9996\u5148\u7981\u7528\u9632\u706b\u5899\uff1a <pre><code>systemctl stop firewalld\nsystemctl disable firewalld\n</code></pre> \u7981\u7528 SELINUX \uff1a <pre><code>setenforce 0\n#\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u9a8c\u8bc1\u662f\u5426\u7981\u7528\u6210\u529f\ncat /etc/selinux/config\nSELINUX=disabled\n</code></pre> \u7531\u4e8e\u5f00\u542f\u5185\u6838 ipv4 \u8f6c\u53d1\u9700\u8981\u52a0\u8f7d br_netfilter \u6a21\u5757\uff0c\u6240\u4ee5\u52a0\u8f7d\u4e0b\u8be5\u6a21\u5757\uff1a <pre><code>modprobe br_netfilter\n</code></pre> \u6700\u597d\u5c06\u4e0a\u9762\u7684\u547d\u4ee4\u8bbe\u7f6e\u6210\u5f00\u673a\u542f\u52a8\uff0c\u56e0\u4e3a\u91cd\u542f\u540e\u6a21\u5757\u5931\u6548\uff0c\u4e0b\u9762\u662f\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d\u6a21\u5757\u7684\u65b9\u5f0f\uff0c\u5728 etc/rc.d/rc.local \u6587\u4ef6\u672b\u5c3e\u6dfb\u52a0\u5982\u4e0b\u811a\u672c\u5185\u5bb9\uff1a <pre><code>for file in /etc/sysconfig/modules/*.modules ; do\n[ -x $file ] &amp;&amp; $file\ndone\n</code></pre> \u7136\u540e\u5728 /etc/sysconfig/modules/ \u76ee\u5f55\u4e0b\u65b0\u5efa\u5982\u4e0b\u6587\u4ef6\uff1a <pre><code> mkdir -p /etc/sysconfig/modules/\n vi /etc/sysconfig/modules/br_netfilter.modules\n modprobe br_netfilter\n</code></pre> \u589e\u52a0\u6743\u9650\uff1a <pre><code>chmod 755 br_netfilter.modules\n</code></pre> \u7136\u540e\u91cd\u542f\u540e\uff0c\u6a21\u5757\u5c31\u53ef\u4ee5\u81ea\u52a8\u52a0\u8f7d\u4e86\uff1a <pre><code>lsmod |grep br_netfilter\nbr_netfilter 22256 0\nbridge 151336 1 br_netfilter\n</code></pre> \u7136\u540e\u521b\u5efa /etc/sysctl.d/k8s.conf \u6587\u4ef6\uff0c\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a <pre><code>net.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\n# \u4e0b\u9762\u7684\u5185\u6838\u53c2\u6570\u53ef\u4ee5\u89e3\u51b3ipvs\u6a21\u5f0f\u4e0b\u957f\u8fde\u63a5\u7a7a\u95f2\u8d85\u65f6\u7684\u95ee\u9898\nnet.ipv4.tcp_keepalive_intvl = 30\nnet.ipv4.tcp_keepalive_probes = 10\nnet.ipv4.tcp_keepalive_time = 600\n</code></pre> \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u4f7f\u4fee\u6539\u751f\u6548\uff1a <pre><code>sysctl -p /etc/sysctl.d/k8s.conf\n</code></pre> \u5b89\u88c5 ipvs\uff1a <pre><code>cat &gt; /etc/sysconfig/modules/ipvs.modules \"%EOF\n#/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nEOF\n\nchmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp;  bash\n/etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4\n</code></pre> \u4e0a\u9762\u811a\u672c\u521b\u5efa\u4e86 /etc/sysconfig/modules/ipvs.modules \u6587\u4ef6\uff0c\u4fdd\u8bc1\u5728\u8282\u70b9\u91cd\u542f\u540e\u80fd\u81ea\u52a8\u52a0\u8f7d\u6240\u9700\u6a21\u5757\u3002\u4f7f\u7528 lsmod | grep -e ip_vs -e nf_conntrack_ipv4 \u547d\u4ee4\u67e5\u770b\u662f\u5426\u5df2\u7ecf\u6b63\u786e\u52a0\u8f7d\u6240\u9700\u7684\u5185\u6838\u6a21\u5757\u3002 \u63a5\u4e0b\u6765\u8fd8\u9700\u8981\u786e\u4fdd\u5404\u4e2a\u8282\u70b9\u4e0a\u5df2\u7ecf\u5b89\u88c5\u4e86 ipset \u8f6f\u4ef6\u5305\uff0c\u4e3a\u4e86\u4fbf\u4e8e\u67e5\u770b ipvs \u7684\u4ee3\u7406\u89c4\u5219\uff0c\u6700\u597d\u5b89\u88c5\u4e00\u4e0b\u7ba1\u7406\u5de5\u5177 ipvsadm\uff1a <pre><code>yum install ipset\nyum install ipvsadm\n</code></pre> \u5173\u95ed swap \u5206\u533a\uff1a <pre><code>swapoff -a\n</code></pre> \u4fee\u6539 /etc/fstab \u6587\u4ef6\uff0c\u6ce8\u91ca\u6389 SWAP \u7684\u81ea\u52a8\u6302\u8f7d\uff0c\u4f7f\u7528 free -m \u786e\u8ba4 swap \u5df2\u7ecf\u5173\u95ed\u3002swappiness \u53c2\u6570\u8c03\u6574\uff0c\u4fee\u6539 /etc/sysctl.d/k8s.conf \u6dfb\u52a0\u4e0b\u9762\u4e00\u884c\uff1a <pre><code>vm.swappiness=0\n</code></pre> \u6267\u884c sysctl -p /etc/sysctl.d/k8s.conf \u4f7f\u4fee\u6539\u751f\u6548\u3002</p>"},{"location":"k8s-learning/k8s-cluster-deploy/kubeadm/#containerd","title":"\u5b89\u88c5 Containerd","text":"<p>\u9996\u5148\u9700\u8981\u5728\u8282\u70b9\u4e0a\u5b89\u88c5 seccomp \u4f9d\u8d56\uff0c\u8fd9\u4e00\u6b65\u5f88\u91cd\u8981\uff1a <pre><code>rpm -qa |grep libseccomp\nlibseccomp-2.3.1-4.el7.x86_64\n# \u5982\u679c\u6ca1\u6709\u5b89\u88c5 libseccomp \u5305\u5219\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5b89\u88c5\u4f9d\u8d56\nwget http://mirror.centos.org/centos/7/os/x86_64/Packages/libseccomp-2.3.1-4.el7.x86_64.rpm\nyum install libseccomp-2.3.1-4.el7.x86_64.rpm -y\n</code></pre> \u7531\u4e8e Containerd \u9700\u8981\u4f9d\u8d56\u5e95\u5c42\u7684 runc \u5de5\u5177\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u9700\u8981\u5148\u5b89\u88c5 runc\uff0c\u4e0d\u8fc7 Containerd \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5305\u542b\u76f8\u5173\u4f9d\u8d56\u7684\u538b\u7f29\u5305 cri-containerd-cni-\\({VERSION}.\\)-${ARCH}.tar.gz\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u5305\u6765\u8fdb\u884c\u5b89\u88c5\uff0c\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528\u8be5\u5b89\u88c5\u5305\uff0c\u4e0d\u7136\u53ef\u80fd\u56e0\u4e3a runc \u7248\u672c\u95ee\u9898\u5bfc\u81f4\u4e0d\u517c\u5bb9</p> <p>\u9996\u5148\u4ece release \u9875\u9762\u4e0b\u8f7d\u6700\u65b0\u7684 1.6.10 \u7248\u672c\u7684\u538b\u7f29\u5305\uff1a <pre><code>wget https://github.com/containerd/containerd/releases/download/v1.6.10/cri-containerd-1.6.10-linux-amd64.tar.gz\n# \u5982\u679c\u6709\u9650\u5236\uff0c\u4e5f\u53ef\u4ee5\u66ff\u6362\u6210\u4e0b\u9762\u7684 URL \u52a0\u901f\u4e0b\u8f7d\nwget https://ghdl.feizhuqwq.cf/https://github.com/containerd/containerd/releases/download/v1.6.10/cri-containerd-1.6.10-linux-amd64.tar.gz\n</code></pre> \u76f4\u63a5\u5c06\u538b\u7f29\u5305\u89e3\u538b\u5230\u7cfb\u7edf\u7684\u5404\u4e2a\u76ee\u5f55\u4e2d\uff1a <pre><code>#tar -C / -xzf cri-containerd-1.6.10-linux-amd64.tar.gz\n</code></pre> \u8bb0\u5f97\u5c06 /usr/local/bin \u548c /usr/local/sbin \u8ffd\u52a0\u5230 PATH \u73af\u5883\u53d8\u91cf\u4e2d\uff1a <pre><code>#echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n#containerd -v\ncontainerd github.com/containerd/containerd v1.6.10\n770bd0108c32f3fb5c73ae1264f7e503fe7b2661\n#runc -h\nrunc: symbol lookup error: runc: undefined symbol: seccomp_notify_respond\n</code></pre> \u53ef\u4ee5\u6b63\u5e38\u6267\u884c containerd -v \u547d\u4ee4\u8bc1\u660e Containerd \u5b89\u88c5\u6210\u529f\u4e86\uff0c\u4f46\u662f\u6267\u884c runc -h \u547d\u4ee4\u7684\u65f6\u5019\u5374\u51fa\u73b0\u4e86\u7c7b\u4f3crunc: undefined symbol: seccomp_notify_respond \u7684\u9519\u8bef\uff0c\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u5f53\u524d\u7cfb\u7edf\u9ed8\u8ba4\u5b89\u88c5\u7684 libseccomp\u662f 2.3.1 \u7248\u672c\uff0c\u8be5\u7248\u672c\u5df2\u7ecf\u4e0d\u80fd\u6ee1\u8db3\u6211\u4eec\u8fd9\u91cc\u7684 v1.6.10 \u7248\u672c\u7684 Containerd \u4e86\uff08\u4ece 1.5.7 \u7248\u672c\u5f00\u59cb\u5c31\u4e0d\u517c\u5bb9\u4e86\uff09\uff0c\u9700\u8981 2.4 \u4ee5\u4e0a\u7684\u7248\u672c\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u91cd\u65b0\u5b89\u88c5\u4e00\u4e2a\u9ad8\u7248\u672c\u7684 libseccomp <pre><code># rpm -qa | grep libseccomp\nlibseccomp-2.3.1-4.el7.x86_64\n# \u4e0b\u8f7d\u9ad8\u4e8e 2.4 \u4ee5\u4e0a\u7684\u5305\n# wget http://rpmfind.net/linux/centos/8-stream/BaseOS/x86_64/os/Packages/libseccomp-2.5.1-1.el8.x86_64.rpm\n#rpm -ivh libseccomp-2.5.1-1.el8.x86_64.rpm\n#rpm -qa | grep libseccomp\nlibseccomp-2.5.1-1.el8.x86_64\n</code></pre> \u73b0\u5728 runc \u547d\u4ee4\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u4e86\uff1a <pre><code>#runc -v\nrunc version 1.1.4\ncommit: v1.1.4-0-g5fd4c4d1\nspec: 1.0.2-dev\ngo: go1.18.8\nlibseccomp: 2.5.1\n</code></pre> Containerd \u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u4e3a /etc/containerd/config.toml\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u6240\u793a\u7684\u547d\u4ee4\u751f\u6210\u4e00\u4e2a\u9ed8\u8ba4\u7684\u914d\u7f6e\uff1a <pre><code>#mkdir -p /etc/containerd\n#containerd config default &gt; /etc/containerd/config.toml\n</code></pre> \u5bf9\u4e8e\u4f7f\u7528 systemd \u4f5c\u4e3a init system \u7684 Linux \u7684\u53d1\u884c\u7248\uff0c\u4f7f\u7528 systemd \u4f5c\u4e3a\u5bb9\u5668\u7684 cgroup driver \u53ef\u4ee5\u786e\u4fdd\u8282\u70b9\u5728\u8d44\u6e90\u7d27\u5f20\u7684\u60c5\u51b5\u66f4\u52a0\u7a33\u5b9a\uff0c\u6240\u4ee5\u63a8\u8350\u5c06 containerd \u7684 cgroup driver \u914d\u7f6e\u4e3a systemd\u3002 \u4fee\u6539\u524d\u9762\u751f\u6210\u7684\u914d\u7f6e\u6587\u4ef6 /etc/containerd/config.toml\uff0c\u5728plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options \u914d\u7f6e\u5757\u4e0b\u9762\u5c06SystemdCgroup \u8bbe\u7f6e\u4e3a true \uff1a <pre><code>[plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc]\n\"\")\n[plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options]\nSystemdCgroup = true\n....\n</code></pre> \u7136\u540e\u518d\u4e3a\u955c\u50cf\u4ed3\u5e93\u914d\u7f6e\u4e00\u4e2a\u52a0\u901f\u5668\uff0c\u9700\u8981\u5728 cri \u914d\u7f6e\u5757\u4e0b\u9762\u7684 registry \u914d\u7f6e\u5757\u4e0b\u9762\u8fdb\u884c\u914d\u7f6e registry.mirrors \uff1a <pre><code>[plugins.\"io.containerd.grpc.v1.cri\"]\n\"\")\n# sandbox_image = \"registry.k8s.io/pause:3.6\"\nsandbox_image = \"registry.aliyuncs.com/k8sxio/pause:3.8\"\n\"\")\n[plugins.\"io.containerd.grpc.v1.cri\".registry]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"docker.io\"]\nendpoint = [\"https:\"(bqr1dr1n.mirror.aliyuncs.com\"]\n[plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"k8s.gcr.io\"]\nendpoint = [\"https:\"(registry.aliyuncs.com/k8sxio\"]\n</code></pre> \u7531\u4e8e\u4e0a\u9762\u6211\u4eec\u4e0b\u8f7d\u7684 Containerd \u538b\u7f29\u5305\u4e2d\u5305\u542b\u4e00\u4e2a etc/systemd/system/containerd.service \u7684\u6587\u4ef6\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 systemd \u6765\u914d\u7f6e Containerd \u4f5c\u4e3a\u5b88\u62a4\u8fdb\u7a0b\u8fd0\u884c\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u5c31\u53ef\u4ee5\u542f\u52a8 Containerd \u4e86\uff0c\u76f4\u63a5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5373\u53ef\uff1a <pre><code>systemctl daemon-reload\nsystemctl enable containerd -- now\n</code></pre> \u542f\u52a8\u5b8c\u6210\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528 Containerd \u7684 CLI \u5de5\u5177 ctr \u548c crictl \u4e86\uff0c\u6bd4\u5982\u67e5\u770b\u7248\u672c\uff1a <pre><code>#ctr version\nClient:\n Version: v1.6.10\n Revision: 770bd0108c32f3fb5c73ae1264f7e503fe7b2661\n Go version: go1.18.8\nServer:\n Version: v1.6.10\n Revision: 770bd0108c32f3fb5c73ae1264f7e503fe7b2661\n UUID: 9b89c1b6-27d0-434b-8c71-243c7af750c5\n#crictl version\nVersion: 0.1.0\nRuntimeName: containerd\nRuntimeVersion: v1.6.10\nRuntimeApiVersion: v1\n</code></pre></p>"},{"location":"k8s-learning/k8s-cluster-deploy/kubeadm/#_2","title":"\u521d\u59cb\u5316\u96c6\u7fa4","text":"<p>\u4e0a\u9762\u7684\u76f8\u5173\u73af\u5883\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u6765\u5b89\u88c5 Kubeadm \u4e86\uff0c\u6211\u4eec\u8fd9\u91cc\u662f\u901a\u8fc7\u6307\u5b9a yum \u6e90\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u5b89\u88c5\u7684\uff1a <pre><code>#cat  /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\n       http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\n</code></pre> \u7136\u540e\u5b89\u88c5 kubeadm\u3001kubelet\u3001kubectl\uff1a <pre><code># --disableexcludes \u7981\u6389\u9664\u4e86kubernetes\u4e4b\u5916\u7684\u522b\u7684\u4ed3\u5e93\n#yum makecache fast\n#yum install -y kubelet-1.25.4 kubeadm-1.25.4 kubectl-1.25.4  --disableexcludes=kubernetes\n#kubeadm version\nkubeadm version: &amp;version.Info{Major:\"1\", Minor:\"25\", GitVersion:\"v1.25.4\",\nGitCommit:\"872a965c6c6526caa949f0c6ac028ef7aff3fb78\", GitTreeState:\"clean\",\nBuildDate:\"2022-11-09T13:35:06Z\", GoVersion:\"go1.19.3\", Compiler:\"gc\",\nPlatform:\"linux/amd64\"}\n</code></pre> \u53ef\u4ee5\u770b\u5230\u6211\u4eec\u8fd9\u91cc\u5b89\u88c5\u7684\u662f v1.25.4 \u7248\u672c\uff0c\u7136\u540e\u5c06 master \u8282\u70b9\u7684 kubelet \u8bbe\u7f6e\u6210\u5f00\u673a\u542f\u52a8\uff1a <pre><code>systemctl enable --now kubelet\n</code></pre> \u63a5\u4e0b\u6765\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u5728 master \u8282\u70b9\u4e0a\u8f93\u51fa\u96c6\u7fa4\u521d\u59cb\u5316\u9ed8\u8ba4\u4f7f\u7528\u7684\u914d\u7f6e\uff1a <pre><code>kubeadm config print init-defaults --component-configs KubeletConfiguration &gt;\nkubeadm.yaml\n</code></pre> \u7136\u540e\u6839\u636e\u6211\u4eec\u81ea\u5df1\u7684\u9700\u6c42\u4fee\u6539\u914d\u7f6e\uff0c\u6bd4\u5982\u4fee\u6539 imageRepository \u6307\u5b9a\u96c6\u7fa4\u521d\u59cb\u5316\u65f6\u62c9\u53d6 Kubernetes \u6240\u9700\u955c\u50cf\u7684\u5730\u5740\uff0ckube-proxy \u7684\u6a21\u5f0f\u4e3a ipvs\uff0c\u53e6\u5916\u9700\u8981\u6ce8\u610f\u7684\u662f\u6211\u4eec\u8fd9\u91cc\u51c6\u5907\u5b89\u88c5 flannel \u7f51\u7edc\u63d2\u4ef6\u7684\uff0c\u9700\u8981\u5c06networking.podSubnet \u8bbe\u7f6e\u4e3a 10.244.0.0/16\uff1a <pre><code>#kubeadm.yaml\napiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n- groups:\n- system:bootstrappers:kubeadm:default-node-token\ntoken: abcdef.0123456789abcdef\nttl: 24h0m0s\nusages:\n- signing\n- authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\nadvertiseAddress: 172.21.0.2\nbindPort: 6443\nnodeRegistration:\ncriSocket: unix:\"\"*var/run/containerd/containerd.sock\nimagePullPolicy: IfNotPresent\nname: master\ntaints:\n- effect: \"NoSchedule\"\nkey: \"node-role.kubernetes.io/master\"\n---\napiServer:\ntimeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns: {}\netcd:\nlocal:\ndataDir: /var/lib/etcd\nimageRepository: registry.aliyuncs.com/k8sxio\nkind: ClusterConfiguration\nkubernetesVersion: 1.25.4\nnetworking:\ndnsDomain: cluster.local\nserviceSubnet: 10.96.0.0/12\npodSubnet: 10.244.0.0/16 # \u6307\u5b9a pod \u5b50\u7f51\nscheduler: {}\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: ipvs # kube-proxy \u6a21\u5f0f\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nauthentication:\nanonymous:\nenabled: false\nwebhook:\ncacheTTL: 0s\nenabled: true\nx509:\nclientCAFile: /etc/kubernetes/pki/ca.crt\nauthorization:\nmode: Webhook\nwebhook:\ncacheAuthorizedTTL: 0s\ncacheUnauthorizedTTL: 0s\ncgroupDriver: systemd\nclusterDNS:\n- 10.96.0.10\nclusterDomain: cluster.local\ncpuManagerReconcilePeriod: 0s\n</code></pre> \u5728\u5f00\u59cb\u521d\u59cb\u5316\u96c6\u7fa4\u4e4b\u524d\u53ef\u4ee5\u4f7f\u7528 kubeadm config images pull --config kubeadm.yaml \u9884\u5148\u5728\u5404\u4e2a\u670d\u52a1\u5668\u8282\u70b9\u4e0a\u62c9\u53d6\u6240 k8s \u9700\u8981\u7684\u5bb9\u5668\u955c\u50cf\u3002 \u914d\u7f6e\u6587\u4ef6\u51c6\u5907\u597d\u8fc7\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5148\u5c06\u76f8\u5173\u955c\u50cf pull \u4e0b\u9762\uff1a <pre><code>#kubeadm config images pull \"'config kubeadm.yaml\n</code></pre> \u4e0a\u9762\u5728\u62c9\u53d6 coredns \u955c\u50cf\u7684\u65f6\u5019\u51fa\u9519\u4e86\uff0c\u6ca1\u6709\u627e\u5230\u8fd9\u4e2a\u955c\u50cf\uff0c\u6211\u4eec\u53ef\u4ee5\u624b\u52a8 pull \u8be5\u955c\u50cf\uff0c\u7136\u540e\u91cd\u65b0 tag \u4e0b\u955c\u50cf\u5730\u5740\u5373\u53ef\uff1a <pre><code>ctr -n k8s.io i pull docker.io/coredns/coredns:1.9.3\nctr -n k8s.io i tag docker.io/coredns/coredns:1.9.3\n</code></pre> \u7136\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u914d\u7f6e\u6587\u4ef6\u5728 master \u8282\u70b9\u4e0a\u8fdb\u884c\u521d\u59cb\u5316\uff1a <pre><code>#kubeadm init --config kubeadm.yaml\n</code></pre> \u6839\u636e\u5b89\u88c5\u63d0\u793a\u62f7\u8d1d kubeconfig \u6587\u4ef6\uff1a <pre><code> #mkdir -p $HOME/.kube\n#sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n#sudo chown $(id -u):$(id -g) $HOME/.kube/config\n</code></pre> \u7136\u540e\u53ef\u4ee5\u4f7f\u7528 kubectl \u547d\u4ee4\u67e5\u770b master \u8282\u70b9\u662f\u5426\u5df2\u7ecf\u521d\u59cb\u5316\u6210\u529f\u4e86\uff1a <pre><code>#kubectl get nodes\nNAME STATUS ROLES AGE VERSION\nmaster NotReady control-plane 104s v1.25.4\n</code></pre> \u73b0\u5728\u8282\u70b9\u8fd8\u5904\u4e8e NotReady \u72b6\u6001\uff0c\u662f\u56e0\u4e3a\u8fd8\u6ca1\u6709\u5b89\u88c5 CNI \u63d2\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u6dfb\u52a0\u4e00\u4e2a Node \u8282\u70b9\uff0c\u518d\u90e8\u7f72\u7f51\u7edc\u63d2\u4ef6\u3002</p>"},{"location":"k8s-learning/k8s-cluster-deploy/kubeadm/#_3","title":"\u6dfb\u52a0\u8282\u70b9","text":"<p>\u8bb0\u4f4f\u521d\u59cb\u5316\u96c6\u7fa4\u4e0a\u9762\u7684\u914d\u7f6e\u548c\u64cd\u4f5c\u8981\u63d0\u524d\u505a\u597d\uff0c\u5c06 master \u8282\u70b9\u4e0a\u9762\u7684 $HOME/.kube/config \u6587\u4ef6\u62f7\u8d1d\u5230 node \u8282\u70b9\u5bf9\u5e94\u7684\u6587\u4ef6\u4e2d\uff08\u5982\u679c\u60f3\u5728 node \u8282\u70b9\u4e0a\u64cd\u4f5c kubectl\uff09\uff0c\u5b89\u88c5 kubeadm\u3001kubelet\u3001kubectl\uff08\u53ef\u9009\uff09\uff0c\u7136\u540e\u6267\u884c\u4e0a\u9762\u521d\u59cb\u5316\u5b8c\u6210\u540e\u63d0\u793a\u7684 join \u547d\u4ee4\u5373\u53ef <pre><code>kubeadm join 172.21.0.2:6443 --token abcdef.0123456789abcdef --discovery-token-ca-cert-hash\n</code></pre></p> <p>\u5982\u679c\u5fd8\u8bb0\u4e86\u4e0a\u9762\u7684 join \u547d\u4ee4\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 kubeadm token create --print-join-command \u91cd\u65b0\u83b7\u53d6\u3002</p> <p>\u6267\u884c\u6210\u529f\u540e\u8fd0\u884c get nodes \u547d\u4ee4\uff1a <pre><code>#kubectl get nodes\nNAME STATUS ROLES AGE VERSION\nmaster NotReady control-plane 15m v1.25.4\nnode1 NotReady &lt;none&gt; 98s v1.25.4\n</code></pre> \u8fd9\u4e2a\u65f6\u5019\u5176\u5b9e\u96c6\u7fa4\u8fd8\u4e0d\u80fd\u6b63\u5e38\u4f7f\u7528\uff0c\u56e0\u4e3a\u8fd8\u6ca1\u6709\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\uff0c\u63a5\u4e0b\u6765\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\uff0c\u53ef\u4ee5\u5728\u6587\u6863 https:\"(kubernetes.io/docs/concepts/cluster-administration/addons \u4e2d\u9009\u62e9\u6211\u4eec\u81ea\u5df1\u7684\u7f51\u7edc\u63d2\u4ef6\uff0c\u8fd9\u91cc\u6211\u4eec\u5b89\u88c5flannel: <pre><code>#wget https://raw.githubusercontent.com/flannel-io/flannel/v0.20.1/Documentation/kube-flannel.yml\n# \u5982\u679c\u6709\u8282\u70b9\u662f\u591a\u7f51\u5361\uff0c\u5219\u9700\u8981\u5728\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\u4e2d\u6307\u5b9a\u5185\u7f51\u7f51\u5361\n# \u641c\u7d22\u5230\u540d\u4e3a kube-flannel-ds \u7684 DaemonSet\uff0c\u5728kube-flannel\u5bb9\u5668\u4e0b\u9762\n\n#vi kube-flannel.yml\n......\ncontainers:\n- name: kube-flannel\n#image: flannelcni/flannel:v0.20.1 for ppc64le and mips64le (dockerhub limitations may\napply)\nimage: docker.io/rancher/mirrored-flannelcni-flannel:v0.20.1\ncommand:\n- /opt/bin/flanneld\nargs:\n- --ip-masq\n- --kube-subnet-mgr\n- --iface=eth0 # \u5982\u679c\u662f\u591a\u7f51\u5361\u7684\u8bdd\uff0c\u6307\u5b9a\u5185\u7f51\u7f51\u5361\u7684\u540d\u79f0\n......\n# kubectl apply -f kube-flannel.yml # \u5b89\u88c5 flannel \u7f51\u7edc\u63d2\u4ef6\n</code></pre> \u7528\u540c\u6837\u7684\u65b9\u6cd5\u6dfb\u52a0\u53e6\u5916\u4e00\u4e2a\u8282\u70b9\u5373\u53ef\u3002</p>"},{"location":"k8s-learning/k8s-cluster-deploy/kubeadm/#_4","title":"\u6e05\u7406","text":"<p>\u5982\u679c\u4f60\u7684\u96c6\u7fa4\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u9047\u5230\u4e86\u5176\u4ed6\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u8fdb\u884c\u91cd\u7f6e\uff1a ```bash  kubeadm reset ifconfig cni0 down &amp;&amp; ip link delete cni0 ifconfig flannel.1 down &amp;&amp; ip link delete flannel.1 rm -rf /var/lib/cni/</p>"},{"location":"k8s-network/networkType/","title":"K8S\u7f51\u7edc","text":"<p>\u70b9\u51fb\u5de6\u4fa7\u76ee\u5f55\u6253\u5f00\u6587\u7ae0</p>"},{"location":"tips/markdownEditor/","title":"markdown\u7f16\u8f91\u5668\u5feb\u6377\u952e","text":"<p>\u4e00\uff1a\u83dc\u5355\u680f</p> <p>\u6587\u4ef6\uff1aalt+F</p> <p>\u7f16\u8f91\uff1aalt+E</p> <p>\u6bb5\u843d\uff1aalt+P</p> <p>\u683c\u5f0f\uff1aalt+O</p> <p>\u89c6\u56fe\uff1aalt+V</p> <p>\u4e3b\u9898\uff1aalt+T</p> <p>\u5e2e\u52a9\uff1aalt+H</p> <p>\u4e8c\uff1a\u6587\u4ef6</p> <p>\u65b0\u5efa\uff1aCtrl+N</p> <p>\u65b0\u5efa\u7a97\u53e3\uff1aCtrl+Shift+N</p> <p>\u6253\u5f00\uff1aCtrl+O</p> <p>\u5feb\u901f\u6253\u5f00\uff1aCtrl+P</p> <p>\u4fdd\u5b58\uff1aCtrl+S</p> <p>\u53e6\u5b58\u4e3a\uff1aCtrl+Shift+S</p> <p>\u504f\u597d\uff1aCtrl+,</p> <p>\u5173\u95ed\uff1aCtrl+W</p> <p>\u4e09\uff1a\u7f16\u8f91</p> <p>\u64a4\u9500\uff1aCtrl+Z</p> <p>\u91cd\u505a\uff1aCtrl+Y</p> <p>\u526a\u5207\uff1aCtrl+X</p> <p>\u590d\u5236\uff1aCtrl+C</p> <p>\u7c98\u8d34\uff1aCtrl+V</p> <p>\u590d\u5236\u4e3aMarkDown\uff1aCtrl+Shift+C</p> <p>\u7c98\u8d34\u4e3a\u7eaf\u6587\u672c\uff1aCtrl+Shift+V</p> <p>\u5168\u9009\uff1aCtrl+A</p> <p>\u9009\u4e2d\u5f53\u524d\u884c/\u53e5\uff1aCtrl+L</p> <p>\u9009\u4e2d\u5f53\u524d\u683c\u5f0f\u6587\u672c\uff1aCtrl+E</p> <p>\u9009\u4e2d\u5f53\u524d\u8bcd\uff1aCtrl+D</p> <p>\u8df3\u8f6c\u5230\u6587\u9996\uff1aCtrl+Home</p> <p>\u8df3\u8f6c\u5230\u6240\u9009\u5185\u5bb9\uff1aCtrl+J</p> <p>\u8df3\u8f6c\u5230\u6587\u672b\uff1aCtrl+End</p> <p>\u67e5\u627e\uff1aCtrl+F</p> <p>\u67e5\u627e\u4e0b\u4e00\u4e2a\uff1aF3</p> <p>\u67e5\u627e\u4e0a\u4e00\u4e2a\uff1aShift+F3</p> <p>\u66ff\u6362\uff1aCtrl+H</p> <p>\u56db\uff1a\u6bb5\u843d</p> <p>\u6807\u9898\uff1aCtrl+1/2/3/4/5</p> <p>\u6bb5\u843d\uff1aCtrl+0</p> <p>\u589e\u5927\u6807\u9898\u7ea7\u522b\uff1aCtrl+=</p> <p>\u51cf\u5c11\u6807\u9898\u7ea7\u522b\uff1aCtrl+-</p> <p>\u8868\u683c\uff1aCtrl+T</p> <p>\u4ee3\u7801\u5757\uff1aCtrl+Shift+K</p> <p>\u516c\u5f0f\u5757\uff1aCtrl+Shift+M</p> <p>\u5f15\u7528\uff1aCtrl+Shift+Q</p> <p>\u6709\u5e8f\u5217\u8868\uff1aCtrl+Shift+[</p> <p>\u65e0\u5e8f\u5217\u8868\uff1aCtrl+Shift+]</p> <p>\u589e\u52a0\u7f29\u8fdb\uff1aCtrl+]</p> <p>\u51cf\u5c11\u7f29\u8fdb\uff1aCtrl+[</p> <p>\u4e94\uff1a\u683c\u5f0f</p> <p>\u52a0\u7c97\uff1aCtrl+B</p> <p>\u659c\u4f53\uff1aCtrl+I</p> <p>\u4e0b\u5212\u7ebf\uff1aCtrl+U</p> <p>\u4ee3\u7801\uff1aCtrl+Shift+`</p> <p>\u5220\u9664\u7ebf\uff1aAlt+Shift+5</p> <p>\u8d85\u94fe\u63a5\uff1aCtrl+K</p> <p>\u56fe\u50cf\uff1aCtrl+Shift+I</p> <p>\u6e05\u9664\u6837\u5f0f\uff1aCtrl+</p> <p>\u516d\uff1a\u89c6\u56fe</p> <p>\u663e\u793a\u9690\u85cf\u4fa7\u8fb9\u680f\uff1aCtrl+Shift+L</p> <p>\u5927\u7eb2\u89c6\u56fe\uff1aCtrl+Shift+1</p> <p>\u6587\u6863\u5217\u8868\u89c6\u56fe\uff1aCtrl+Shift+2</p> <p>\u6587\u4ef6\u6811\u89c6\u56fe\uff1aCtrl+Shift+3</p> <p>\u6e90\u4ee3\u7801\u6a21\u5f0f\uff1aCtrl+/</p> <p>\u4e13\u6ce8\u6a21\u5f0f\uff1aF8</p> <p>\u6253\u5b57\u673a\u6a21\u5f0f\uff1aF9</p> <p>\u5207\u6362\u5168\u5c4f\uff1aF11</p> <p>\u5b9e\u9645\u5927\u5c0f\uff1aCtrl+Shift+0</p> <p>\u653e\u5927\uff1aCtrl+Shift+=</p> <p>\u7f29\u5c0f\uff1aCtrl+Shift+-</p> <p>\u5e94\u7528\u5185\u7a97\u53e3\u5207\u6362\uff1aCtrl+Tab</p> <p>\u6253\u5f00DevTools\uff1aShift+F12</p>"},{"location":"tips/mkdocs/","title":"mkdocs\u5b89\u88c5\u4f7f\u7528","text":"<p>1\u3001\u4f9d\u8d56\u6761\u4ef6\uff1apython  pip 2\u3001\u5b89\u88c5\u6b65\u9aa4\uff1apip install mkdocs 3\u3001\u521b\u5efa\u7ad9\u70b9\uff1amkdocs new mkdocs-site</p> <p>\u53c2\u8003\u8d44\u6599:</p> <p>Material for mkdocs\u5b98\u65b9\u6587\u6863: https://squidfunk.github.io/mkdocs-material/setup/changing-the-colors/#color-palette</p> <p>MkDocs\u6784\u5efa\u793a\u4f8b: https://yang-xijie.github.io/BLOG/Markdown/mkdocs-site/</p>"},{"location":"work/urlGuide/","title":"\u5de5\u4f5c","text":"<p>\u70b9\u51fb\u5de6\u4fa7\u76ee\u5f55\u6253\u5f00\u6587\u7ae0</p>"}]}